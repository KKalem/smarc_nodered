[
    {
        "id": "072468ee5a218dc0",
        "type": "tab",
        "label": "V2 Robot State",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "65c60c3b274f73e3",
        "type": "tab",
        "label": "V2 Map",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1301e8ab7fdd3e72",
        "type": "mqtt-broker",
        "name": "mqtt_broker",
        "broker": "broker",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "95aa286d35eafbda",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "71f95dd3ceeb2145",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Command and Conquer Subs",
            "hideToolbar": "true",
            "allowSwipe": "false",
            "lockMenu": "icon",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 40,
                "sy": 40,
                "gx": 2,
                "gy": 2,
                "cx": 2,
                "cy": 2,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "1417de57d250f31f",
        "type": "ui_group",
        "name": "State",
        "tab": "95aa286d35eafbda",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "102ceb2b72c23b34",
        "type": "ui_group",
        "name": "Map",
        "tab": "95aa286d35eafbda",
        "order": 2,
        "disp": false,
        "width": 18,
        "collapse": false,
        "className": ""
    },
    {
        "id": "d95a7e5bd038651c",
        "type": "key-value-store",
        "filepath": "waypoints.json",
        "namespace": "",
        "name": "waypoints"
    },
    {
        "id": "52f0dbb4c9ed8309",
        "type": "ui_group",
        "name": "Security",
        "tab": "95aa286d35eafbda",
        "order": 5,
        "disp": true,
        "width": "3",
        "collapse": true,
        "className": ""
    },
    {
        "id": "9dbddaa8775473fd",
        "type": "ui_group",
        "name": "Waypoint",
        "tab": "95aa286d35eafbda",
        "order": 3,
        "disp": true,
        "width": "4",
        "collapse": true,
        "className": ""
    },
    {
        "id": "574bd822e17b1c3f",
        "type": "ui_group",
        "name": "Mission Plan",
        "tab": "95aa286d35eafbda",
        "order": 4,
        "disp": true,
        "width": "7",
        "collapse": true,
        "className": ""
    },
    {
        "id": "99b5f7c7e1f62814",
        "type": "key-value-store",
        "filepath": "mission_plans.json",
        "namespace": "",
        "name": "mission plans"
    },
    {
        "id": "014f9035e48813bb",
        "type": "ui_tab",
        "name": "V2",
        "icon": "fa-gear",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a48b13904097fb6a",
        "type": "ui_group",
        "name": "Robot Info",
        "tab": "014f9035e48813bb",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "9f2da61.3353758",
        "type": "ui_group",
        "name": "Flight",
        "tab": "d6d3c358.5fb46",
        "order": 1,
        "disp": true,
        "width": "20",
        "collapse": false
    },
    {
        "id": "d6d3c358.5fb46",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "81d4dedb195938c4",
        "type": "ui_group",
        "name": "BT State",
        "tab": "014f9035e48813bb",
        "order": 6,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "542b5325cf729b8f",
        "type": "ui_group",
        "name": "Map",
        "tab": "014f9035e48813bb",
        "order": 2,
        "disp": false,
        "width": "12",
        "collapse": false,
        "className": ""
    },
    {
        "id": "a891e5f5f2effe35",
        "type": "ui_group",
        "name": "Missions",
        "tab": "014f9035e48813bb",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "c68132315359e81c",
        "type": "ui_group",
        "name": "Tracks",
        "tab": "014f9035e48813bb",
        "order": 5,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "ba1fb12713836940",
        "type": "ui_group",
        "name": "Helptext",
        "tab": "014f9035e48813bb",
        "order": 3,
        "disp": false,
        "width": "12",
        "collapse": false,
        "className": ""
    },
    {
        "id": "f5cc24c294e35249",
        "type": "ui_group",
        "name": "Charts",
        "tab": "014f9035e48813bb",
        "order": 7,
        "disp": true,
        "width": 18,
        "collapse": true,
        "className": ""
    },
    {
        "id": "6e27a643e9465b46",
        "type": "ui_spacer",
        "z": "65c60c3b274f73e3",
        "name": "spacer",
        "group": "a48b13904097fb6a",
        "order": 9,
        "width": 6,
        "height": 1
    },
    {
        "id": "274fb14e5bd5e691",
        "type": "ui_spacer",
        "z": "65c60c3b274f73e3",
        "name": "spacer",
        "group": "a48b13904097fb6a",
        "order": 10,
        "width": 6,
        "height": 1
    },
    {
        "id": "5651137da8860824",
        "type": "ui_spacer",
        "z": "65c60c3b274f73e3",
        "name": "spacer",
        "group": "f5cc24c294e35249",
        "order": 6,
        "width": 6,
        "height": 1
    },
    {
        "id": "a04b59e608979f6a",
        "type": "ui_list",
        "z": "072468ee5a218dc0",
        "group": "a48b13904097fb6a",
        "name": "List of robots",
        "order": 1,
        "width": 6,
        "height": 1,
        "lineType": "two",
        "actionType": "click",
        "allowHTML": true,
        "outputs": 1,
        "topic": "",
        "x": 610,
        "y": 1460,
        "wires": [
            [
                "8d60954c80270a11"
            ]
        ]
    },
    {
        "id": "b17ab9737c48ebe8",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "make ui_list config from robot_states",
        "func": "list_config = []\nrobot_states = global.get(\"robot_states\")\nfor(const robot_name in robot_states){\n    robot_state = robot_states[robot_name]\n    since_last_update = (Date.now() - robot_state.last_update)/1000\n    \n    if(since_last_update > 10*60){\n        description_str = \"⌚ >10m ago\"\n    }else{\n        description_str = \"⌚ \"+ since_last_update.toFixed(2) + \"s ago\"\n    }\n    \n    \n    if(since_last_update > 10*60){\n        icon = 'fa-deaf'\n        color = 'grey'\n    }else{\n        icon = 'fa-feed'\n        color = 'black'\n    }\n    \n    if(robot_state.gui.selected){\n        icon = 'fa-eye'\n        color = 'orange'\n    }\n    \n    \n    list_item = {\n        title: \"<font color=\" + color +\">\" + robot_name,\n        description: \"<font color=\" + color +\">\" + description_str,\n        icon_name: icon\n    }\n    list_config.push(list_item)\n}\nreturn {payload:list_config}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1460,
        "wires": [
            [
                "a04b59e608979f6a"
            ]
        ]
    },
    {
        "id": "4a4d95ebe5f4a0a2",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "0.2",
        "props": [],
        "repeat": "0.2",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 720,
        "wires": [
            [
                "573d0d0f99f72b4b"
            ]
        ]
    },
    {
        "id": "8d60954c80270a11",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "select robot",
        "func": "robot_states = global.get(\"robot_states\")\n\n// set all to false\nfor(const robot_name in robot_states){\n    robot_states[robot_name].gui.selected = false\n}\n\n// set clicked to true\ntitle = msg.payload.title\n// strip the html color part\nclicked_robot_name = title.slice(title.indexOf(\">\")+1)\n\nrobot_states[clicked_robot_name].gui.selected = true\nglobal.set(\"robot_states\", robot_states)\nglobal.set(\"gui.selected_robot_name\", clicked_robot_name)\n",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1460,
        "wires": []
    },
    {
        "id": "0a4f4cb54557ce2f",
        "type": "ui_template",
        "z": "072468ee5a218dc0",
        "group": "9f2da61.3353758",
        "name": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "format": "<link rel=\"stylesheet\" href=\"/flight/css/flightindicators.css\"/>\n<script src=\"/flight/js/jquery.flightindicators.js\"></script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "global",
        "className": "",
        "x": 1060,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "2e8781f4b35114a4",
        "type": "ui_template",
        "z": "072468ee5a218dc0",
        "group": "a48b13904097fb6a",
        "name": "Roll, Pitch, Heading",
        "order": 2,
        "width": 6,
        "height": 5,
        "format": "<!--<div><span id=\"attitude\"></span><span id=\"heading\"></span></div> -->\n<div><span id=\"attitude\"></span></div><!--<span id=\"heading\"></span></div> -->\n\n<script>\n(function(scope) {\n    var options = {\n    \tsize : 180,\t\t\t\t// Sets the size in pixels of the indicator (square)\n    \troll : 0,\t\t\t\t// Roll angle in degrees for an attitude indicator\n    \tpitch : 0,\t\t\t\t// Pitch angle in degrees for an attitude indicator\n    \theading: 0,\t\t\t\t// Heading angle in degrees for an heading indicator\n    \tvario: 0,\t\t\t\t// Variometer in 1000 feets/min for the variometer indicator\n    \tairspeed: 0,\t\t\t// Air speed in knots for an air speed indicator\n    \taltitude: 0,\t\t\t// Altitude in feets for an altimeter indicator\n    \tpressure: 1000,\t\t\t// Pressure in hPa for an altimeter indicator\n    \tshowBox : false,\t\t\t// Sets if the outer squared box is visible or not (true or false)\n    \timg_directory : '/flight/img/'\t// The directory where the images are saved to\n    }\n    var atti = $.flightIndicator('#attitude', 'attitude',options);\n    var heading = $.flightIndicator('#heading', 'heading',options);\n    var speed = $.flightIndicator('#airspeed', 'airspeed',options);\n    scope.$watch('msg', function(msg) {\n        if (msg) {\n          if(msg.topic == \"roll\"){\n              atti.setRoll(msg.payload)\n          }\n          if(msg.topic == \"pitch\"){\n              atti.setPitch(-msg.payload)\n          }\n          if(msg.topic == \"heading\"){\n              heading.setHeading(msg.payload)\n          }\n          if(msg.topic == \"speed\"){\n              speed.setAirSpeed(msg.payload)\n          }\n          \n        }\n  });\n})(scope);\n\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 890,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "c375e4a5e57177ab",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[roll, pitch, heading]",
        "func": "if(msg){\n    return [\n        {topic:\"roll\", payload:msg.base.roll},\n        {topic:\"pitch\", payload:msg.base.pitch},\n        {topic:\"heading\", payload:msg.base.heading}\n        ]\n}\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 720,
        "wires": [
            [
                "2e8781f4b35114a4"
            ],
            [
                "2e8781f4b35114a4"
            ],
            [
                "2e8781f4b35114a4"
            ]
        ]
    },
    {
        "id": "971e5bcf85bd8530",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "1",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 1460,
        "wires": [
            [
                "b17ab9737c48ebe8"
            ]
        ]
    },
    {
        "id": "573d0d0f99f72b4b",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "Selected Robot State",
        "func": "gui_state = global.get(\"gui\")\nselected_robot_name = gui_state.selected_robot_name\nrobot_states = global.get(\"robot_states\")\n\nif(!(selected_robot_name in robot_states)){\n    return\n}\n\nreturn robot_states[selected_robot_name]\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 720,
        "wires": [
            [
                "c375e4a5e57177ab",
                "216163265f4ce78b",
                "7d7f737ccec8bdd1",
                "8346958d8c2ff728",
                "5ccaf5f3bf5ae5cf",
                "828367982cce7ef2",
                "06273715c2b93708",
                "f7efa4aab9068b8b",
                "2ff30366f2047da7",
                "a72e19700d060cf2",
                "38bcedbf48c85d68"
            ]
        ]
    },
    {
        "id": "216163265f4ce78b",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[vbs, lcg, tcg]",
        "func": "if(msg){\n    return [\n        {topic:\"vbs\", payload:msg.base.vbs},\n        {topic:\"lcg\", payload:msg.base.lcg},\n        {topic:\"tcg\", payload:msg.base.tcg},\n        ]\n}\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 800,
        "wires": [
            [
                "4e4363d933c20d6c"
            ],
            [
                "656a52f66d5d0bda"
            ],
            [
                "d0bc35b89669966d"
            ]
        ]
    },
    {
        "id": "7d7f737ccec8bdd1",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[T1, T2]",
        "func": "if(msg){\n    return [\n        {topic:\"t1\", payload:msg.base.t1},\n        {topic:\"t2\", payload:msg.base.t2}\n        ]\n}\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 900,
        "wires": [
            [
                "edb7322d84e1824d"
            ],
            [
                "5c9b93966cd3ce1c"
            ]
        ]
    },
    {
        "id": "4e4363d933c20d6c",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "VBS",
        "group": "a48b13904097fb6a",
        "order": 5,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "VBS",
        "label": "%",
        "format": "{{value | number:2}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 760,
        "wires": []
    },
    {
        "id": "656a52f66d5d0bda",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "LCG",
        "group": "a48b13904097fb6a",
        "order": 6,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "LCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 800,
        "wires": []
    },
    {
        "id": "edb7322d84e1824d",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "T1",
        "group": "a48b13904097fb6a",
        "order": 3,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "T1",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 850,
        "y": 880,
        "wires": []
    },
    {
        "id": "5c9b93966cd3ce1c",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "T2",
        "group": "a48b13904097fb6a",
        "order": 4,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "T2",
        "label": "rpm",
        "format": "{{value | number:1}}",
        "min": "-2000",
        "max": "2000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "-800",
        "seg2": "800",
        "className": "",
        "x": 850,
        "y": 920,
        "wires": []
    },
    {
        "id": "d0bc35b89669966d",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "TCG",
        "group": "a48b13904097fb6a",
        "order": 8,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "TCG",
        "label": "%",
        "format": "{{value | number:1}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "30",
        "seg2": "60",
        "className": "",
        "x": 850,
        "y": 840,
        "wires": []
    },
    {
        "id": "8346958d8c2ff728",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "BT Tip Log",
        "func": "// \"bt\": {\n//             \"tip\": {\n//                 \"name\": \"???\",\n//                 \"message\": \"\",\n//                 \"status\": \"???\"\n//             },\n//             \"algae_farm_enable\": false,\n//             \"live_wp_enable\": false,\n//             \"gui_wp_enable\": false,\n//             \"current_wp\": {},\n//             \"current_plan\": {},\n//             \"last_heartbeat\": null\n//         },\n\nfunction make_tip_str(tip){\n    c = \"black\"\n    icon = \"\"\n    switch(tip.status){\n        case \"failure\":\n            c = \"red\"\n            icon = \"❌\"\n            break\n        case \"success\":\n            c = \"green\"\n            icon = \"✅\"\n            break\n        case \"running\":\n            c = \"blue\"\n            icon = \"⚙️\"\n            break\n    }\n    \n    tip_type = tip.name.slice(0,1)\n    tip_name = tip.name.slice(2)\n    \n    t = \"\"\n    if(tip.time > 10){\n        t = new Date(tip.time).toTimeString().slice(0,8)\n    }\n    \n    title = icon + \" <font color=\" + c + \">\" + tip_name\n    msg = \"<font color=\" + c +\">[\" + t + \"] \" + tip.message\n    \n    return [title, msg];\n}\n\n// dont do anything if the robot we got is not selected\nif(!(msg.gui.selected)){\n    return\n}\n\ncurrent_tip = msg.bt.tip;\n\n\n// get the current log, make sure its length matches the value \n// set in the gui and then put it back into global context\ngui_state = global.get(\"gui\")\ntips = msg.gui.bt_tip_log\ntip_log_len = gui_state.bt_tip_log_len\n// too short\nwhile(tips.length < tip_log_len){\n    tips.push({\n        name:\"\",\n        message:\"\",\n        status:\"\",\n        time:\"\"\n    })\n}\n// too long\nif(tips.length > tip_log_len){\n    tips = tips.slice(0,tip_log_len)\n}\n\nlast_tip = tips[0]\nif(last_tip){\n    if (!(last_tip.name == current_tip.name && last_tip.status == current_tip.status)){\n        // something meaningful have changed, shift things around\n        for(let i=tips.length-1; i>0; i--){\n            tips[i] = tips[i-1]\n        }\n    }\n}\n// otherwise just update the top\ntips[0] = current_tip\ntips[0].time = Date.now()\n\n//finally update the log with the latest state of the log\nglobal.set(\"robot_states['\"+msg.base.name+\"'].gui.bt_tip_log\", tips)\n\nouts = []\nfor(let i=0; i<tips.length; i++){\n    r = make_tip_str(tips[i])\n    list_item = {\n        title: r[0],\n        description: r[1]\n    }\n    outs.push(list_item)\n}\n\nreturn {payload:outs};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 1020,
        "wires": [
            [
                "93832a52fddd1fe6"
            ]
        ]
    },
    {
        "id": "c50d772c522ec5c1",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "lat_lon",
        "topic": "smarc/+/dr/lat_lon",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 160,
        "wires": [
            [
                "e58d020e0faf117d",
                "a7de6573427c3182"
            ]
        ]
    },
    {
        "id": "d8a229ed73bf1a50",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Yaw",
        "topic": "smarc/+/dr/yaw",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 160,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "d933ebc2598c89a7",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Depth",
        "topic": "smarc/+/dr/depth",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 200,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "ce5f3fc1415b3d44",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Roll",
        "topic": "smarc/+/dr/roll",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 200,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "f1f6aa8630b2459f",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Pitch",
        "topic": "smarc/+/dr/pitch",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 160,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "6bc6d108042d5433",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "VBS_fb",
        "topic": "smarc/+/core/vbs_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 240,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "1e257bc81da80283",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "LCG_fb",
        "topic": "smarc/+/core/lcg_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 280,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "cb767c1ced5d8bfa",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "T1_fb",
        "topic": "smarc/+/core/thruster1_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 240,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "b7d61f1afee897a8",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "T2_fb",
        "topic": "smarc/+/core/thruster2_fb",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 310,
        "y": 280,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "5ab4d2fba4e40e73",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "batt",
        "topic": "smarc/+/core/battery",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 280,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "3ef59b0e6f35a957",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "gps",
        "topic": "smarc/+/core/gps",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 200,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "88437af12ac3ebb4",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "Altitude",
        "topic": "smarc/+/dr/altitude",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 430,
        "y": 240,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "5c17640c744c8c15",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "goto_wp_goal",
        "topic": "smarc/+/bt/last_wp",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 360,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "73e7fa1d9b7b8bc2",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt tip",
        "topic": "smarc/+/bt/tip",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 350,
        "y": 360,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "1447262162547810",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "livewp enable",
        "topic": "smarc/+/bt/live_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 400,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "9fdc56fc7a754fcd",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "algae enable",
        "topic": "smarc/+/bt/algae_farm/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 370,
        "y": 400,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "a0a635a67725ceec",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt heartbeat",
        "topic": "smarc/+/bt/heartbeat",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 490,
        "y": 360,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "16ac9c75fa3b93ca",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "bt missioncontrol",
        "topic": "smarc/+/bt/mission_control",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 540,
        "y": 400,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "2a5530edfa53f040",
        "type": "mqtt in",
        "z": "072468ee5a218dc0",
        "name": "guiwp enable",
        "topic": "smarc/+/bt/gui_wp/enable",
        "qos": "0",
        "datatype": "json",
        "broker": "1301e8ab7fdd3e72",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 650,
        "y": 360,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "e58d020e0faf117d",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "update robot state",
        "func": "function to_deg(d){\n    deg = d * (180/Math.PI);\n    deg = deg%360;\n    return deg;\n}\n\nfunction to_northing(d){\n    h = Math.PI/2 - d;\n    return to_deg(h);\n}\n\nfunction new_robot_state(robot_name){\n    return {\n        \"last_update\":0,\n        \"base\": {\n            \"name\": robot_name,\n            \"lat\": null,\n            \"lon\": null,\n            \"utm_x\": null,\n            \"utm_y\": null,\n            \"utm_z\":null,\n            \"heading\": 0,\n            \"roll\": 0,\n            \"pitch\": 0,\n            \"depth\": 0,\n            \"altitude\": 0,\n            \"vbs\": 0,\n            \"lcg\": 0,\n            \"tcg\": 0,\n            \"t1\": 0,\n            \"t2\": 0,\n            \"batt_v\": 0,\n            \"gps_lat\": null,\n            \"gps_lon\": null\n        },\n        \"bt\": {\n            \"tip\": {\n                \"name\": \"???\",\n                \"message\": \"\",\n                \"status\": \"???\"\n            },\n            \"algae_farm_enable\": false,\n            \"live_wp_enable\": false,\n            \"gui_wp_enable\": false,\n            \"current_wp\": {},\n            \"current_plan\": {},\n            \"last_heartbeat\": null,\n        },\n        \"gui\": {\n            \"selected\": false,\n            \"is_old\":false,\n            \"bt_tip_log\":[],\n            \"batt_v_minmax\":[9999,-1],\n            \"dr\":{\n                \"name\": robot_name,\n                \"label\": robot_name,\n                \"tooltip\": robot_name,\n                \"lat\": null,\n                \"lon\": null,\n                \"heading\": 0,\n                \"layer\": robot_name,\n                \"icon\": \"ship\",\n                \"color\": \"yellow\",\n                \"iconColor\": \"yellow\"\n            },\n            \"gps\":{\n                \"name\": robot_name+\"_gps\",\n                \"tooltip\": robot_name,\n                \"lat\": null,\n                \"lon\": null,\n                \"layer\": robot_name,\n                \"icon\": \"satellite\",\n                \"color\": \"green\",\n                \"iconColor\": \"green\",\n            },\n        }\n    }\n}\n\n// each mqtt_in node also emits the entire topic\n// so we can switch robot name and which topic it is coming from\nconst [smarc, robot_name, ...topic_parts] = msg.topic.split('/');\nmqtt_topic = topic_parts.join(\"/\")\n\n// then try to get this robot from the list of vehicles\n// if its not there, construct an empty state object\nrobot_states = global.get(\"robot_states\")\n\nif(!(robot_states)){\n    global.set(\"robot_states\", {})\n}\n\nif(!(robot_name in robot_states)){\n    robot_states[robot_name] = new_robot_state(robot_name)\n}\n\nrobot_state = robot_states[robot_name]\n\n\nrobot_state.last_update = Date.now()\n\npayload = msg.payload\nswitch(mqtt_topic){\n    case \"dr/lat_lon\":\n        robot_state.base.lat = payload.latitude;\n        robot_state.base.lon = payload.longitude;\n        robot_state.gui.dr.lat = payload.latitude;\n        robot_state.gui.dr.lon = payload.longitude;\n        break;\n        \n    case \"dr/utm\":\n        robot_state.base.utm_x = payload.utm.x;\n        robot_state.base.utm_y = payload.utm.y;\n        robot_state.base.utm_z = payload.utm.z;\n        break\n        \n    case \"dr/yaw\":\n        hdg = to_northing(payload.data)\n        robot_state.base.heading = hdg;\n        robot_state.gui.dr.heading = hdg;\n        break;\n        \n    case \"dr/roll\":\n        robot_state.base.roll = to_deg(payload.data);\n        break;\n        \n    case \"dr/pitch\":\n        robot_state.base.pitch = to_deg(payload.data);\n        break;\n        \n    case \"dr/depth\":\n        robot_state.base.depth = payload.data;\n        break;\n\n    case \"dr/altitude\":\n        robot_state.base.altitude = payload.data;\n        break;        \n        \n    case \"core/vbs_fb\":\n        robot_state.base.vbs = payload.value;\n        break;\n        \n    case \"core/lcg_fb\":\n        robot_state.base.lcg = payload.value;\n        break;\n        \n    case \"core/thruster1_fb\":\n        robot_state.base.t1 = payload.rpm.rpm;\n        break;\n        \n    case \"core/thruster2_fb\":\n        robot_state.base.t2 = payload.rpm.rpm;\n        break;\n        \n    case \"core/battery\":\n        robot_state.base.batt_v = payload.voltage;\n        break;\n        \n    case \"core/gps\":\n        robot_state.base.gps_lat = payload.latitude;\n        robot_state.base.gps_lon = payload.longitude;\n        robot_state.gui.gps.lat = payload.latitude;\n        robot_state.gui.gps.lon = payload.longitude;\n        break;\n        \n    case \"bt/last_wp\":\n        robot_state.bt.current_wp = payload;\n        break;\n        \n    case \"bt/tip\":\n        robot_state.bt.tip.name = payload.name;\n        robot_state.bt.tip.message = payload.message;\n        status_str = {\n            0:\"unknown\",\n            1:\"invalid\",\n            2:\"running\",\n            3:\"success\",\n            4:\"failure\"\n        }\n        robot_state.bt.tip.status = status_str[payload.status]\n        break;\n        \n    case \"bt/live_wp/enable\":\n        robot_state.bt.live_wp_enable = payload.data;\n        break;\n        \n    case \"bt/algae_farm/enable\":\n        robot_state.bt.algae_farm_enable = payload.data;\n        break;\n        \n    case \"bt/gui_wp/enable\":\n        robot_state.bt.gui_wp_enable = payload.data;\n        break;\n        \n    case \"bt/heartbeat\":\n        robot_state.bt.last_heartbeat = Date.now()\n        break;\n        \n    case \"bt/mission_control\":\n        if(payload.command == 5){ // is_feedback\n            robot_state.bt.current_plan = payload\n        }\n}",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 260,
        "wires": []
    },
    {
        "id": "93832a52fddd1fe6",
        "type": "ui_list",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "name": "BT Log",
        "order": 2,
        "width": 6,
        "height": 3,
        "lineType": "three",
        "actionType": "none",
        "allowHTML": true,
        "outputs": 0,
        "topic": "",
        "x": 860,
        "y": 1020,
        "wires": []
    },
    {
        "id": "268c9d6ea03e8ef2",
        "type": "ui_numeric",
        "z": "072468ee5a218dc0",
        "name": "",
        "label": "BT Log Len",
        "tooltip": "",
        "group": "81d4dedb195938c4",
        "order": 4,
        "width": 6,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": "1",
        "max": "20",
        "step": 1,
        "className": "",
        "x": 410,
        "y": 1500,
        "wires": [
            [
                "850a3a74ca62d541"
            ]
        ]
    },
    {
        "id": "850a3a74ca62d541",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gui.bt_tip_log_len",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "2ad1bf5fcff4a626",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "gui.bt_tip_log_len",
        "payloadType": "global",
        "x": 210,
        "y": 1500,
        "wires": [
            [
                "268c9d6ea03e8ef2"
            ]
        ]
    },
    {
        "id": "9a4668d9403279bb",
        "type": "ui_gauge",
        "z": "072468ee5a218dc0",
        "name": "",
        "group": "a48b13904097fb6a",
        "order": 7,
        "width": 3,
        "height": 2,
        "gtype": "gage",
        "title": "Battery V",
        "label": "V",
        "format": "{{value | number:2}}",
        "min": "10",
        "max": "14",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "12",
        "seg2": "13",
        "className": "",
        "x": 860,
        "y": 960,
        "wires": []
    },
    {
        "id": "5ccaf5f3bf5ae5cf",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "[current V, minmax]",
        "func": "//batt_minmax = global.get(\"gui_state.batt_v_minmax\")\nbatt_minmax = msg.gui.batt_v_minmax\nmin = batt_minmax[0]\nmax = batt_minmax[1]\ncurrent = msg.base.batt_v\n\nif(current >= max){\n    max = current+2\n}\nif(current <= min){\n    min = current-2\n}\nglobal.set(\"robot_states['\"+msg.base.name+\"'].gui.batt_v_minmax\", [min, max])\n\n\nreturn [\n    {topic:\"batt\", payload:current},\n    {ui_control: {min:min, max:max}}\n    ]\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 960,
        "wires": [
            [
                "9a4668d9403279bb"
            ],
            [
                "9a4668d9403279bb"
            ]
        ]
    },
    {
        "id": "0ad56f79c71f0cc7",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "deploy",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 910,
        "y": 220,
        "wires": [
            [
                "92a2d6eb5f8e7b77"
            ]
        ]
    },
    {
        "id": "92a2d6eb5f8e7b77",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "reset robot_states on deploy",
        "rules": [
            {
                "t": "set",
                "p": "robot_states",
                "pt": "global",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "828367982cce7ef2",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "Unselect if old, select on reconnect",
        "func": "if(msg){\n    robot_state = msg\n    since_last_update = (Date.now() - robot_state.last_update)/1000\n    gui_key = \"robot_states['\"+robot_state.base.name+\"'].gui\"\n    \n    if(since_last_update > 10*60){\n        global.set(gui_key+\".is_old\", true)\n        global.set(gui_key+\".selected\", false)\n        global.set(gui_key+\".dr.color\", \"grey\")\n        global.set(gui_key+\".dr.iconColor\", \"grey\")\n        global.set(gui_key+\".gps.color\", \"grey\")\n        global.set(gui_key+\".gps.iconColor\", \"grey\")\n        global.set(gui_key+\".dr.label\", \"\")\n        return {enabled:false}\n    }\n    \n    if(since_last_update > 60){\n        global.set(gui_key+\".selected\", false)\n        global.set(gui_key+\".dr.color\", \"yellow\")\n        global.set(gui_key+\".dr.iconColor\", \"yellow\")\n        global.set(gui_key+\".gps.color\", \"yellow\")\n        global.set(gui_key+\".gps.iconColor\", \"yellow\")\n        global.set(gui_key+\".dr.label\", \"\")\n        global.set(gui_key+\".is_old\", false)\n    }else{\n        global.set(gui_key+\".selected\", true)\n        global.set(gui_key+\".dr.color\", \"orange\")\n        global.set(gui_key+\".dr.iconColor\", \"orange\")\n        global.set(gui_key+\".gps.color\", \"green\")\n        global.set(gui_key+\".gps.iconColor\", \"green\")\n        global.set(gui_key+\".dr.label\", robot_state.base.name)\n        global.set(gui_key+\".is_old\", false)\n    }\n    return {enabled:true}\n}\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 640,
        "wires": [
            [
                "984d3208cf3f44dc",
                "cdf2cf72778b09da"
            ]
        ]
    },
    {
        "id": "984d3208cf3f44dc",
        "type": "debug",
        "z": "072468ee5a218dc0",
        "name": "",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": true,
        "complete": "enabled",
        "targetType": "msg",
        "statusVal": "enabled",
        "statusType": "auto",
        "x": 950,
        "y": 600,
        "wires": []
    },
    {
        "id": "b486adbab9a480eb",
        "type": "link in",
        "z": "072468ee5a218dc0",
        "name": "toggle readouts",
        "links": [
            "cf8fbcc8cd92e83a"
        ],
        "x": 345,
        "y": 900,
        "wires": [
            [
                "2e8781f4b35114a4",
                "4e4363d933c20d6c",
                "656a52f66d5d0bda",
                "d0bc35b89669966d",
                "edb7322d84e1824d",
                "5c9b93966cd3ce1c",
                "9a4668d9403279bb",
                "dbd6fb5b7d052a8f",
                "3748bff36aacd609"
            ]
        ]
    },
    {
        "id": "27d98d0f695deeec",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "toggle readouts",
        "info": "",
        "x": 240,
        "y": 900,
        "wires": []
    },
    {
        "id": "cf8fbcc8cd92e83a",
        "type": "link out",
        "z": "072468ee5a218dc0",
        "name": "",
        "mode": "link",
        "links": [
            "b486adbab9a480eb",
            "dee9d1fab2fcec69"
        ],
        "x": 1055,
        "y": 660,
        "wires": []
    },
    {
        "id": "4eab10166ad7a6f6",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "toggle readouts",
        "info": "",
        "x": 1160,
        "y": 660,
        "wires": []
    },
    {
        "id": "cdf2cf72778b09da",
        "type": "delay",
        "z": "072468ee5a218dc0",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 950,
        "y": 660,
        "wires": [
            [
                "cf8fbcc8cd92e83a"
            ]
        ]
    },
    {
        "id": "07c8e88c8e7446f2",
        "type": "link in",
        "z": "072468ee5a218dc0",
        "name": "helptext",
        "links": [
            "246b0fccde35e02f",
            "de2b74099f9267ca"
        ],
        "x": 595,
        "y": 1680,
        "wires": [
            [
                "bad9531a.ac42d"
            ]
        ]
    },
    {
        "id": "1356cb29988fd215",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "helptext",
        "info": "",
        "x": 520,
        "y": 1680,
        "wires": []
    },
    {
        "id": "bad9531a.ac42d",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "helptext",
        "func": "if(!msg.payload) return;\n\nconst MAXLINES = 500;\nlet data = flow.get(\"data\") || [];\nif(msg.topic==\"clear\") {\n    data = [];\n} else {\n    t = new Date(Date.now()).toTimeString().slice(0,8)\n    line = \"<font color=gray>[\"+ t +\"]  \"\n    switch(msg.topic){\n        case \"connection\":\n            switch(msg.payload){\n                case \"connect\":\n                case \"change\":\n                    line += \"(\"+msg.socketip+\")\"\n            }\n            line += \" is here!\"\n            line = \"<font color=green>\" + line\n            break\n        default:\n            line += \"<font color=black>\"+ msg.payload\n    }\n    \n    data.unshift({title:line});\n    data = data.slice(0, MAXLINES);\n}\nflow.set(\"data\", data);\n\nreturn {payload:data}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1720,
        "wires": [
            [
                "14cef28c9b363aa9"
            ]
        ]
    },
    {
        "id": "8824d559b51e8ff1",
        "type": "ui_button",
        "z": "072468ee5a218dc0",
        "name": "clear",
        "group": "ba1fb12713836940",
        "order": 5,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "Clears the help log",
        "color": "",
        "bgcolor": "red",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "clear",
        "topicType": "str",
        "x": 560,
        "y": 1720,
        "wires": [
            [
                "bad9531a.ac42d"
            ]
        ]
    },
    {
        "id": "896214991f49dc69",
        "type": "ui_ui_control",
        "z": "072468ee5a218dc0",
        "name": "",
        "events": "connect",
        "x": 370,
        "y": 1640,
        "wires": [
            [
                "2aee03ce280bf49f",
                "35398d09d2f397c0"
            ]
        ]
    },
    {
        "id": "2aee03ce280bf49f",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "connection",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 1640,
        "wires": [
            [
                "bad9531a.ac42d"
            ]
        ]
    },
    {
        "id": "35398d09d2f397c0",
        "type": "debug",
        "z": "072468ee5a218dc0",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 520,
        "y": 1600,
        "wires": []
    },
    {
        "id": "14cef28c9b363aa9",
        "type": "ui_list",
        "z": "072468ee5a218dc0",
        "group": "ba1fb12713836940",
        "name": "helptexts",
        "order": 3,
        "width": 11,
        "height": 2,
        "lineType": "one",
        "actionType": "none",
        "allowHTML": true,
        "outputs": 0,
        "topic": "",
        "x": 850,
        "y": 1720,
        "wires": []
    },
    {
        "id": "b74e9e43d39d2943",
        "type": "ui_text_input",
        "z": "072468ee5a218dc0",
        "name": "usertext",
        "label": "Log something?",
        "tooltip": "Say something?",
        "group": "ba1fb12713836940",
        "order": 1,
        "width": 11,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "user",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1760,
        "wires": [
            [
                "bad9531a.ac42d",
                "e394c4c322482237"
            ]
        ]
    },
    {
        "id": "a1ae28d9.0d25",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "Clear Value",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "null",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 1820,
        "wires": [
            [
                "b74e9e43d39d2943"
            ]
        ]
    },
    {
        "id": "e394c4c322482237",
        "type": "delay",
        "z": "072468ee5a218dc0",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 1820,
        "wires": [
            [
                "a1ae28d9.0d25"
            ]
        ]
    },
    {
        "id": "093f0d1ff195539a",
        "type": "ui_button",
        "z": "072468ee5a218dc0",
        "name": "ping",
        "group": "ba1fb12713836940",
        "order": 2,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "Get attention",
        "color": "",
        "bgcolor": "blue",
        "className": "",
        "icon": "fa-volume-up",
        "payload": "I need an adult in node red please",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 290,
        "y": 1960,
        "wires": [
            [
                "916c4b8093a21ecc",
                "9ddd81dfb1ab5d51",
                "b119d0a4ac56786a"
            ]
        ]
    },
    {
        "id": "c816724e1c29b129",
        "type": "ui_switch",
        "z": "072468ee5a218dc0",
        "name": "",
        "label": "",
        "tooltip": "",
        "group": "ba1fb12713836940",
        "order": 4,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 260,
        "y": 1720,
        "wires": [
            [
                "426351cea6a5d463"
            ]
        ]
    },
    {
        "id": "426351cea6a5d463",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 1720,
        "wires": [
            [
                "8824d559b51e8ff1"
            ]
        ]
    },
    {
        "id": "af9eda3169c82d4f",
        "type": "inject",
        "z": "072468ee5a218dc0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 130,
        "y": 1720,
        "wires": [
            [
                "c816724e1c29b129"
            ]
        ]
    },
    {
        "id": "47de367d43c3b66c",
        "type": "ui_audio",
        "z": "072468ee5a218dc0",
        "name": "",
        "group": "ba1fb12713836940",
        "voice": "urn:moz-tts:speechd:English%20(Great%20Britain)?en",
        "always": true,
        "x": 620,
        "y": 1960,
        "wires": []
    },
    {
        "id": "916c4b8093a21ecc",
        "type": "delay",
        "z": "072468ee5a218dc0",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 440,
        "y": 1960,
        "wires": [
            [
                "47de367d43c3b66c"
            ]
        ]
    },
    {
        "id": "9ddd81dfb1ab5d51",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "disable",
        "rules": [
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 2040,
        "wires": [
            [
                "093f0d1ff195539a",
                "a148da7fdd377498"
            ]
        ]
    },
    {
        "id": "a148da7fdd377498",
        "type": "delay",
        "z": "072468ee5a218dc0",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 480,
        "y": 2040,
        "wires": [
            [
                "7a7acdab644af9aa"
            ]
        ]
    },
    {
        "id": "7a7acdab644af9aa",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "enable",
        "rules": [
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 2040,
        "wires": [
            [
                "093f0d1ff195539a"
            ]
        ]
    },
    {
        "id": "de2b74099f9267ca",
        "type": "link out",
        "z": "072468ee5a218dc0",
        "name": "",
        "mode": "link",
        "links": [
            "07c8e88c8e7446f2"
        ],
        "x": 545,
        "y": 1920,
        "wires": []
    },
    {
        "id": "3691746500e38fa4",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "helptext",
        "info": "",
        "x": 620,
        "y": 1920,
        "wires": []
    },
    {
        "id": "b119d0a4ac56786a",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "user",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 1920,
        "wires": [
            [
                "de2b74099f9267ca"
            ]
        ]
    },
    {
        "id": "94c5c6015b1e339c",
        "type": "utm",
        "z": "072468ee5a218dc0",
        "name": "",
        "precision": "5",
        "x": 730,
        "y": 140,
        "wires": [
            [
                "e58d020e0faf117d"
            ]
        ]
    },
    {
        "id": "a7de6573427c3182",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "prep for utm",
        "func": "parts = msg.topic.split(\"/\")\nparts[parts.length-1] = \"utm\"\ntopic = parts.join(\"/\")\n\nreturn {payload:{\n    lat:msg.payload.latitude, \n    lon:msg.payload.longitude},\n    topic: topic\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 140,
        "wires": [
            [
                "94c5c6015b1e339c"
            ]
        ]
    },
    {
        "id": "06273715c2b93708",
        "type": "rbe",
        "z": "072468ee5a218dc0",
        "name": "when robot plan changes",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "bt.current_plan",
        "topi": "topic",
        "x": 670,
        "y": 1160,
        "wires": [
            [
                "a9b89912dfc6513c",
                "5c6f8c65db082642",
                "8c406069befc16fd"
            ]
        ]
    },
    {
        "id": "116bcc6cdb02e4a8",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "update_markers_on_map",
        "info": "",
        "x": 970,
        "y": 1120,
        "wires": []
    },
    {
        "id": "a9b89912dfc6513c",
        "type": "link out",
        "z": "072468ee5a218dc0",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 835,
        "y": 1120,
        "wires": []
    },
    {
        "id": "dbd6fb5b7d052a8f",
        "type": "ui_text",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "Current plan text",
        "label": "Current plan:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1100,
        "y": 1160,
        "wires": []
    },
    {
        "id": "5c6f8c65db082642",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "prepare plan text",
        "func": "srn = global.get(\"gui.selected_robot_name\")\nif(!srn) return\nrobots = global.get(\"robot_states\")\nrobot = robots[srn]\nif(!robot) return\n\nplan = robot.bt.current_plan\n\nswitch(plan.plan_state){\n    case 0: //running\n        c = \"green\"\n        e = \"▶️\"\n        break\n    case 1: // stopped\n        c = \"#3f90bf\"\n        e = \"⏹️\"\n        break\n    case 2: // paused\n        c = \"gray\"\n        e = \"⏸️\"\n        break\n    case 3: // emergency\n        c = \"red\"\n        e = \"‼️\"\n        break\n    case 4: // received\n        c = \"orange\"\n        e = \"📥\"\n        break\n}\n\nt = e + \" <font color=\" + c +\">\" + plan.name\n\nreturn {payload:t}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1160,
        "wires": [
            [
                "dbd6fb5b7d052a8f"
            ]
        ]
    },
    {
        "id": "f7efa4aab9068b8b",
        "type": "rbe",
        "z": "072468ee5a218dc0",
        "name": "when robot wp changes",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "bt.current_wp",
        "topi": "topic",
        "x": 670,
        "y": 1120,
        "wires": [
            [
                "a9b89912dfc6513c"
            ]
        ]
    },
    {
        "id": "8c406069befc16fd",
        "type": "function",
        "z": "072468ee5a218dc0",
        "name": "compare plan to gui",
        "func": "srn = global.get(\"gui.selected_robot_name\")\nif(!srn) return\nrobots = global.get(\"robot_states\")\nrobot = robots[srn]\nif(!robot) return\n\nrobot_plan = robot.bt.current_plan\n\nplans = global.get(\"planning.plans\")\ngui_plan = plans[robot_plan.name]\n\nglobal.set(\"gui.plan_is_synched\", false)\n\nif(!gui_plan) return {payload:false}\n\nfor(var i=0; i < robot_plan.waypoints.length; i++){\n    r_wp = robot_plan.waypoints[i]\n    node.warn(r_wp)\n    if(!r_wp) return {payload:false}\n    \n    g_wp_n = gui_plan.waypoint_order[i]\n    g_wp = gui_plan.waypoints[g_wp_n]\n    node.warn(g_wp)\n    if(!g_wp) return {payload:false}\n    // just compare the first 6 decimal digits of the latlon\n    ra = (\"\"+r_wp.lat).slice(0,9)\n    ga = (\"\"+g_wp.lat).slice(0,9)\n    ro = (\"\"+r_wp.lon).slice(0,9)\n    go = (\"\"+g_wp.lon).slice(0,9)\n    node.warn(ra + \" = \" + ga)\n    if(ra != ga) return {payload:false}\n    node.warn(ro + \" = \" + go)\n    if(ro != go) return {payload:false}\n}\n\nglobal.set(\"gui.plan_is_synched\", true)\nreturn {payload:true}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1200,
        "wires": [
            [
                "7207113d4e01d2b1",
                "3748bff36aacd609"
            ]
        ]
    },
    {
        "id": "f73376f194b1fc1a",
        "type": "link in",
        "z": "072468ee5a218dc0",
        "name": "compare gui and robot plans",
        "links": [
            "0f1be0abe9e97cb2",
            "3f285282ab31161f",
            "e986e36477fb6a0d",
            "9e017fbc9b746fb9",
            "050fbc517aa6868e",
            "69e69b055fdc6d3d",
            "af81f151aebb2dcc"
        ],
        "x": 575,
        "y": 1200,
        "wires": [
            [
                "5ecd5d57f488339c"
            ]
        ]
    },
    {
        "id": "0fba2cfa1c65669d",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 420,
        "y": 1200,
        "wires": []
    },
    {
        "id": "5ecd5d57f488339c",
        "type": "delay",
        "z": "072468ee5a218dc0",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "3",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 710,
        "y": 1200,
        "wires": [
            [
                "8c406069befc16fd"
            ]
        ]
    },
    {
        "id": "7207113d4e01d2b1",
        "type": "link out",
        "z": "072468ee5a218dc0",
        "name": "",
        "mode": "link",
        "links": [
            "2012902f23543fb8"
        ],
        "x": 1035,
        "y": 1240,
        "wires": []
    },
    {
        "id": "33881016d8022102",
        "type": "comment",
        "z": "072468ee5a218dc0",
        "name": "toggle plan buttons",
        "info": "",
        "x": 1160,
        "y": 1240,
        "wires": []
    },
    {
        "id": "3748bff36aacd609",
        "type": "ui_text",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "plan is syn",
        "label": "Plan is synched: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1090,
        "y": 1200,
        "wires": []
    },
    {
        "id": "16cd0a89713fac55",
        "type": "ui_text",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "live wp enabled",
        "label": "Live WP:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 840,
        "y": 1300,
        "wires": []
    },
    {
        "id": "2ff30366f2047da7",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "live_wp_enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "bt.live_wp_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1300,
        "wires": [
            [
                "16cd0a89713fac55"
            ]
        ]
    },
    {
        "id": "eb054c07307cdcc2",
        "type": "ui_text",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "gui wp enabled",
        "label": "GUI WP:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 840,
        "y": 1340,
        "wires": []
    },
    {
        "id": "a72e19700d060cf2",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "gui_wp_enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "bt.gui_wp_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1340,
        "wires": [
            [
                "eb054c07307cdcc2"
            ]
        ]
    },
    {
        "id": "7c25be2f2bb43ee4",
        "type": "ui_text",
        "z": "072468ee5a218dc0",
        "group": "81d4dedb195938c4",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "algae farm enabled",
        "label": "Algae farm:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 850,
        "y": 1380,
        "wires": []
    },
    {
        "id": "38bcedbf48c85d68",
        "type": "change",
        "z": "072468ee5a218dc0",
        "name": "algae_farm_enable",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "bt.algae_farm_enable",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1380,
        "wires": [
            [
                "7c25be2f2bb43ee4"
            ]
        ]
    },
    {
        "id": "61ce2b718be73daf",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Sweden.map",
        "func": "msg = {payload:{command:{}}};\nmsg.payload.command.map = {\n    \"overlay\":\"Bathy\", \n    \"url\":\"http://nodered.blue-robots.com/mapserver\",\n    \"opt\":{ \n        \"map\":\"/etc/mapserver/sweden.map\",\n        \"layers\":\"CONTOUR\",\n        \"format\":\"image/png\",\n        \"service\":\"wms\",\n        \"transparent\":true\n    },\n    \"wms\":true\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 480,
        "wires": [
            [
                "93d9f503a3372651"
            ]
        ]
    },
    {
        "id": "d8ab75012918ab43",
        "type": "ui_worldmap",
        "z": "65c60c3b274f73e3",
        "group": "542b5325cf729b8f",
        "order": 1,
        "width": 12,
        "height": 12,
        "name": "",
        "lat": "58.25089840041283",
        "lon": "11.4500587783608",
        "zoom": "16",
        "layer": "EsriS",
        "cluster": "",
        "maxage": "",
        "usermenu": "show",
        "layers": "show",
        "panit": "false",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "true",
        "coords": "deg",
        "showgrid": "true",
        "allowFileDrop": "false",
        "path": "/worldmap_v2",
        "overlist": "SN",
        "maplist": "EsriS,NatGeo",
        "mapname": "Bathy",
        "mapurl": "https://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",
        "mapopt": "{ \"maxZoom\":22,\"attribution\":\"&copy; GEBCO\",\"format\":\"image/jpeg\",\"request\":\"getmap\",\"service\":\",\"layers\":\"gebco_latest_2_sub_ice_topo\"}",
        "mapwms": true,
        "x": 1270,
        "y": 80,
        "wires": []
    },
    {
        "id": "1e0bd19ab17b797e",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_worldmap",
        "links": [
            "93d9f503a3372651",
            "86db72e5aa5e61cc",
            "8fdedc66ae19b198",
            "f73d51a768277c0b",
            "eaae728ca769c3c1",
            "3910098f87fb5eac",
            "c7d4d5de96d19781",
            "b185f6dbb37952e9",
            "7e03fe39a9e4785c",
            "46477f626df8f436"
        ],
        "x": 1155,
        "y": 80,
        "wires": [
            [
                "d8ab75012918ab43"
            ]
        ]
    },
    {
        "id": "93d9f503a3372651",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_from_map_setup",
        "mode": "link",
        "links": [
            "1e0bd19ab17b797e"
        ],
        "x": 685,
        "y": 500,
        "wires": []
    },
    {
        "id": "74196b529b53271e",
        "type": "worldmap in",
        "z": "65c60c3b274f73e3",
        "name": "",
        "path": "/worldmap_v2",
        "events": "connect,point,layer,bounds,other",
        "x": 110,
        "y": 140,
        "wires": [
            [
                "fd6727bdbf9a2edd",
                "f59da3a9a9790cbb"
            ]
        ]
    },
    {
        "id": "f59da3a9a9790cbb",
        "type": "debug",
        "z": "65c60c3b274f73e3",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 20,
        "wires": []
    },
    {
        "id": "fd6727bdbf9a2edd",
        "type": "switch",
        "z": "65c60c3b274f73e3",
        "name": "map actions",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "connected",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bounds",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "button",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "point",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "move",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 290,
        "y": 140,
        "wires": [
            [
                "ecb32f1e69ab1244"
            ],
            [
                "692a9362905a1825"
            ],
            [
                "acaa0403e6b2f92a"
            ],
            [
                "e2f686ad8c4ade79"
            ],
            [
                "7d660feb1bc9828d"
            ]
        ]
    },
    {
        "id": "ecb32f1e69ab1244",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_connected",
        "mode": "link",
        "links": [
            "5a7bf884410b6994",
            "6b9216a6aec78960",
            "34b418616dff4704",
            "c64c7c9fbc69557c",
            "6868207dbe3c8fe2",
            "07bfda0c88113da1",
            "844b7bcc930e1da0",
            "7a6888b95672e0f7"
        ],
        "x": 435,
        "y": 60,
        "wires": []
    },
    {
        "id": "692a9362905a1825",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_bounds",
        "mode": "link",
        "links": [],
        "x": 435,
        "y": 100,
        "wires": []
    },
    {
        "id": "5a7bf884410b6994",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 445,
        "y": 480,
        "wires": [
            [
                "61ce2b718be73daf",
                "24bfe69168ea9d8c"
            ]
        ]
    },
    {
        "id": "db811466da709501",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 520,
        "y": 60,
        "wires": []
    },
    {
        "id": "733036b10ed33646",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "bounds",
        "info": "",
        "x": 510,
        "y": 100,
        "wires": []
    },
    {
        "id": "acaa0403e6b2f92a",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_button",
        "mode": "link",
        "links": [
            "608b681c2b10d2c7"
        ],
        "x": 435,
        "y": 140,
        "wires": []
    },
    {
        "id": "f2fa2605c1b981d7",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "button",
        "info": "",
        "x": 510,
        "y": 140,
        "wires": []
    },
    {
        "id": "e493560291ec0b19",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 360,
        "y": 480,
        "wires": []
    },
    {
        "id": "608b681c2b10d2c7",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_on_press",
        "links": [
            "acaa0403e6b2f92a"
        ],
        "x": 305,
        "y": 520,
        "wires": [
            [
                "be264f174c773c7e"
            ]
        ]
    },
    {
        "id": "0ffae76eff0a2978",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "button",
        "info": "",
        "x": 230,
        "y": 520,
        "wires": []
    },
    {
        "id": "d697d87f8e6123ae",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "map",
        "info": "",
        "x": 770,
        "y": 500,
        "wires": []
    },
    {
        "id": "be264f174c773c7e",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "on_press",
        "func": "key = false\nswitch(msg.payload.name){\n    case(\"Toggle follow\"):\n        key = \"follow_selected_vehicle\"\n        break\n    case(\"Toggle tracks\"):\n        key = \"draw_tracks\"\n        break\n    default:\n        node.warn(\"Unhandled map button!\")\n}\n\nif(key){\n    key = \"gui.\"+key\n    if(global.get(key)){\n        global.set(key, false)\n    }else{\n        global.set(key, true)\n    }\n}\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 520,
        "wires": [
            [
                "24bfe69168ea9d8c"
            ]
        ]
    },
    {
        "id": "24bfe69168ea9d8c",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "map buttons",
        "func": "function make_button(button){\n    m = {payload:{command:{}}};\n    \n    if(global.get(\"gui.\"+button.global_key)){\n        icon = button.icon_true\n    }else{\n        icon = button.icon_false\n    }\n    \n    m.payload.command = { \n        \"button\": {\n            \"name\":button.name,\n            \"icon\": icon,\n            \"position\":\"topleft\" \n        } \n    }\n    return m\n}\n\nfunction remove_button(name){\n    m = {payload:{command:{}}};\n    m.payload.command = { \n        \"button\": {\n            \"name\":name,\n        } \n    }\n    return m\n}\n\n\nbuttons = [\n    // {\n    //     \"global_key\":\"draw_tracks\",\n    //     \"name\":\"Toggle tracks\",\n    //     \"icon_true\":\"fa-sheqel\",\n    //     \"icon_false\":\"fa-blind\"\n    // },\n    {\n        \"global_key\":\"follow_selected_vehicle\",\n        \"name\":\"Toggle follow\",\n        \"icon_true\":\"fa-eye\",\n        \"icon_false\":\"fa-low-vision\"\n    }\n]\n\nfor(var button of buttons){\n    node.send(remove_button(button.name))\n    node.send(make_button(button))\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 520,
        "wires": [
            [
                "93d9f503a3372651"
            ]
        ]
    },
    {
        "id": "0a961438ad73e32f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "robot_drs",
        "func": "msg = {payload:[]}\nrobot_states = global.get(\"robot_states\")\nfor(const robot_name in robot_states){\n    r = robot_states[robot_name]\n    msg.payload.push(r.gui.dr)\n}\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 240,
        "wires": [
            [
                "3910098f87fb5eac"
            ]
        ]
    },
    {
        "id": "327b70467ae735a8",
        "type": "inject",
        "z": "65c60c3b274f73e3",
        "name": "0.2s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 710,
        "y": 260,
        "wires": [
            [
                "0a961438ad73e32f",
                "0599c19152ae4c80"
            ]
        ]
    },
    {
        "id": "0599c19152ae4c80",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "robot_gps's",
        "func": "msg = {payload:[]}\nrobot_states = global.get(\"robot_states\")\nfor(const robot_name in robot_states){\n    r = robot_states[robot_name]\n    msg.payload.push(r.gui.gps)\n}\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 280,
        "wires": [
            [
                "3910098f87fb5eac"
            ]
        ]
    },
    {
        "id": "84763f6e6162102a",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "center map on selected robot",
        "func": "gui_state = global.get(\"gui\")\n\nif(!(gui_state.follow_selected_vehicle)){\n    return\n}\n\n\nselected_robot_name = gui_state.selected_robot_name\nrobot_states = global.get(\"robot_states\")\n\nif(!(selected_robot_name in robot_states)){\n    return\n}\nr = robot_states[selected_robot_name]\n\nif(!(r.gui.selected)){\n    return\n}\n\nm = {\"payload\": {\n        \"command\":{\n            \"lat\": r.base.lat,\n            \"lon\": r.base.lon\n        }\n    }}\n    \nreturn m",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 320,
        "wires": [
            [
                "3910098f87fb5eac"
            ]
        ]
    },
    {
        "id": "eb0c3ad39ee41a83",
        "type": "inject",
        "z": "65c60c3b274f73e3",
        "name": "0.5s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 710,
        "y": 320,
        "wires": [
            [
                "84763f6e6162102a"
            ]
        ]
    },
    {
        "id": "87855a030ad4b56e",
        "type": "ui_switch",
        "z": "65c60c3b274f73e3",
        "name": "planning mode",
        "label": "Planning Mode",
        "tooltip": "",
        "group": "a891e5f5f2effe35",
        "order": 9,
        "width": 6,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 540,
        "y": 640,
        "wires": [
            [
                "d01a1c27b3eb717f",
                "5096e7318cafb35a",
                "af81f151aebb2dcc"
            ]
        ]
    },
    {
        "id": "d01a1c27b3eb717f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "set map clickability",
        "func": "return {\n    payload:{\n        command:{\n            hiderightclick: !msg.payload\n            \n        }}}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 640,
        "wires": [
            [
                "7e03fe39a9e4785c"
            ]
        ]
    },
    {
        "id": "00cf2d88e242ecc9",
        "type": "config",
        "z": "65c60c3b274f73e3",
        "name": "planning",
        "properties": [
            {
                "p": "planning",
                "pt": "global",
                "to": "{\"plans\":{},\"tracks\":{}}",
                "tot": "json"
            }
        ],
        "active": false,
        "x": 1280,
        "y": 180,
        "wires": []
    },
    {
        "id": "c36e098b35484df1",
        "type": "ui_text_input",
        "z": "65c60c3b274f73e3",
        "name": "lat,lon",
        "label": "Lat,Lon",
        "tooltip": "LAT, LON input",
        "group": "a891e5f5f2effe35",
        "order": 12,
        "width": 6,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "0",
        "topic": "latlon",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 830,
        "y": 2440,
        "wires": [
            [
                "959cd51c0cd7ca20"
            ]
        ]
    },
    {
        "id": "b35ff4ff8ec16352",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "get/set selected wp",
        "func": "reset = [\n    {payload:\"\"},\n    {payload:\"\"},\n    {payload:\"\"},\n    {payload:\"\"},\n    {payload:false}\n    ]\n    \ntitle = msg.payload.title\nif(title == \"--NO PLANS--\" || title == \"--NO WPS--\") return reset\n\nwp_name = title.slice(title.indexOf(\">\")+1)\n\nglobal.set(\"gui.selected_waypoint_name\", wp_name)\n\n\n\n\nplan_name = global.get(\"gui.selected_plan_name\")\nplans = global.get(\"planning.plans\")\nif(!(plans)) return reset\nplan = plans[plan_name]\nif(!(plan)) return reset\nswp = plan.waypoints[wp_name]\nif(!(swp)) return reset\n\nlat = (swp.lat+\"\").substring(0,9)\nlon = (swp.lon+\"\").substring(0,9)\n\nreturn [\n    {payload: lat + \", \"+ lon},\n    {payload:swp.depth},\n    {payload:swp.rpm},\n    {payload:swp.speed},\n    {payload:swp.use_rpm}\n    ]",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2620,
        "wires": [
            [
                "c36e098b35484df1"
            ],
            [
                "6596fde6e6662884"
            ],
            [
                "1ce3149408193422"
            ],
            [
                "b5d55ffd8630fd60"
            ],
            [
                "7d1b8d23041dbcc3",
                "f265c0e56f9d21af"
            ]
        ]
    },
    {
        "id": "7d1b8d23041dbcc3",
        "type": "ui_switch",
        "z": "65c60c3b274f73e3",
        "name": "use_rpm",
        "label": "Use RPM",
        "tooltip": "",
        "group": "a891e5f5f2effe35",
        "order": 16,
        "width": 3,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "use_rpm",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 840,
        "y": 2600,
        "wires": [
            [
                "959cd51c0cd7ca20"
            ]
        ]
    },
    {
        "id": "6596fde6e6662884",
        "type": "ui_text_input",
        "z": "65c60c3b274f73e3",
        "name": "depth",
        "label": "Depth",
        "tooltip": "",
        "group": "a891e5f5f2effe35",
        "order": 13,
        "width": 3,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "0",
        "topic": "depth",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 830,
        "y": 2480,
        "wires": [
            [
                "959cd51c0cd7ca20"
            ]
        ]
    },
    {
        "id": "1ce3149408193422",
        "type": "ui_text_input",
        "z": "65c60c3b274f73e3",
        "name": "RPM",
        "label": "RPM",
        "tooltip": "",
        "group": "a891e5f5f2effe35",
        "order": 14,
        "width": 3,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "0",
        "topic": "rpm",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 830,
        "y": 2520,
        "wires": [
            [
                "959cd51c0cd7ca20"
            ]
        ]
    },
    {
        "id": "b5d55ffd8630fd60",
        "type": "ui_text_input",
        "z": "65c60c3b274f73e3",
        "name": "speed",
        "label": "Speed",
        "tooltip": "in m/s",
        "group": "a891e5f5f2effe35",
        "order": 15,
        "width": 3,
        "height": 1,
        "passthru": false,
        "mode": "text",
        "delay": "0",
        "topic": "speed",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 830,
        "y": 2560,
        "wires": [
            [
                "959cd51c0cd7ca20"
            ]
        ]
    },
    {
        "id": "959cd51c0cd7ca20",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "validate and edit WP",
        "func": "plans = global.get(\"planning.plans\")\nplan_name = global.get(\"gui.selected_plan_name\")\nplan = plans[plan_name]\nif(!(plan)){\n    return\n}\n\nname = global.get(\"gui.selected_waypoint_name\")\nif(!(name in plan.waypoints)){\n    return\n}\n\n\n\nswitch(msg.topic){\n    case(\"latlon\"):\n        // magic regex that checks for lat,lon formatting\n        const regexExp = /^((\\-?|\\+?)?\\d+(\\.\\d+)?),\\s*((\\-?|\\+?)?\\d+(\\.\\d+)?)$/gi;\n        if(regexExp.test(msg.payload)){\n            parts = msg.payload.split(\",\")\n            lat = parseFloat(parts[0])\n            lon = parseFloat(parts[1])\n            plan.waypoints[name].lat = lat\n            plan.waypoints[name].lon = lon\n        }else{\n            node.warn(\"Latlon format is bad:\"+msg.payload)\n            return {payload:false}    \n        }\n        break\n        \n    case(\"depth\"):\n        // should be a float\n        try{\n            depth = parseFloat(msg.payload) || 0\n            plan.waypoints[name].depth = depth\n        }catch{\n            node.warn(\"Depth is not float:\"+msg.payload)\n            return {payload:false}\n        }\n        break\n    case(\"rpm\"):\n        // should be an int\n        try{\n            rpm = parseInt(msg.payload) || 0\n            plan.waypoints[name].rpm = rpm\n        }catch{\n             node.warn(\"RPM is not int:\"+msg.payload)\n            return {payload:false}\n        }\n        break\n    case(\"speed\"):\n        // should be a float\n        try{\n            speed = parseFloat(msg.payload) || 0\n            plan.waypoints[name].speed = speed\n        }catch{\n            node.warn(\"Speed is not float:\"+msg.payload)\n            return {payload:false}\n        }\n        break\n    \n    case(\"use_rpm\"):\n        // the widget can only return good stuff, no need to check\n        plan.waypoints[name].use_rpm = msg.payload\n}\n\n// and finally, set the new version of the plan globally\nglobal.set(\"planning.plans\", plans)\nreturn {payload:true}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 2520,
        "wires": [
            [
                "2a3c96232faf5eb1",
                "6ecdeb474d97bb05"
            ]
        ]
    },
    {
        "id": "2a3c96232faf5eb1",
        "type": "ui_led",
        "z": "65c60c3b274f73e3",
        "order": 17,
        "group": "a891e5f5f2effe35",
        "width": 3,
        "height": 1,
        "label": "OK:",
        "labelPlacement": "left",
        "labelAlignment": "left",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "bool"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "square",
        "showGlow": false,
        "name": "wp gud",
        "x": 1320,
        "y": 2480,
        "wires": []
    },
    {
        "id": "0f340b20aa6be0bf",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "list plans",
        "func": "plans = global.get(\"planning.plans\")\n\n\nif(!(plans)){\n    return {payload:[{title:\"--NO PLANS--\"}]}  \n} \nif(Object.keys(plans).length < 1){\n    return {payload:[{title:\"--NO PLANS--\"}]}     \n}\n\nselected_plan_name = global.get(\"gui.selected_plan_name\")\nlist_items = []\nfor(const plan_name in plans){\n    \n    if(plan_name == selected_plan_name){\n        c = \"orange\"\n    }else{\n        c = \"black\"\n    }\n    title = \"<font color=\" + c +\">\" + plan_name\n    list_item = {title:title}\n    list_items.push(list_item)\n}\n\nreturn {payload:list_items}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1640,
        "wires": [
            [
                "12e1c75e32095cfb"
            ]
        ]
    },
    {
        "id": "12e1c75e32095cfb",
        "type": "ui_list",
        "z": "65c60c3b274f73e3",
        "group": "a891e5f5f2effe35",
        "name": "Plan list",
        "order": 4,
        "width": 6,
        "height": 3,
        "lineType": "two",
        "actionType": "click",
        "allowHTML": true,
        "outputs": 1,
        "topic": "",
        "x": 520,
        "y": 1640,
        "wires": [
            [
                "f1bfe65ccc40afd7"
            ]
        ]
    },
    {
        "id": "f1bfe65ccc40afd7",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "set selected plan",
        "func": "title = msg.payload.title\nif(title == \"--NO PLANS--\") return\nplan_name = title.slice(title.indexOf(\">\")+1)\n\nglobal.set(\"gui.selected_plan_name\", plan_name)\n\nreturn {payload:plan_name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1640,
        "wires": [
            [
                "183bd5b7b2e98b79",
                "a7eba2ef10edab1f",
                "66be8a1b9908737a",
                "389bc260103b7207"
            ]
        ]
    },
    {
        "id": "46fcc943a269e1d7",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "new plan",
        "group": "a891e5f5f2effe35",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "New Plan",
        "tooltip": "Create a new empty mission plan",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-map",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 380,
        "y": 1780,
        "wires": [
            [
                "5fc53fc5f677e010",
                "c4ac075074761e27"
            ]
        ]
    },
    {
        "id": "5fc53fc5f677e010",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "create and select new plan",
        "func": "function new_plan(){\n    t = new Date(Date.now()).toTimeString().slice(0,8)\n    return {\n        name:\"NEW PLAN-\"+ t,\n        waypoints:{},\n        waypoint_order:[]\n    }\n}\n\nplan = new_plan()\nplans = global.get(\"planning.plans\")\nplans[plan.name] = plan\nglobal.set(\"planning.plans\", plans)\nglobal.set(\"gui.selected_plan_name\", plan.name)\n\nreturn {payload:plan, topic:\"new_plan\"}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 1800,
        "wires": [
            [
                "06b52e62f1cf32f9"
            ]
        ]
    },
    {
        "id": "f68e69985169cd78",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "list waypoints",
        "func": "plans = global.get(\"planning.plans\")\nselected_plan_name = global.get(\"gui.selected_plan_name\")\nselected_waypoint_name = global.get(\"gui.selected_waypoint_name\")\nplan = plans[selected_plan_name]\nif(!(plan)) return {payload:[{title:\"--NO PLAN--\"}]}\n\nlist_items = []\nfor(const wp_name of plan.waypoint_order){\n    \n    if(wp_name == selected_waypoint_name){\n        c = \"orange\"\n    }else{\n        c = \"black\"\n    }\n    title = \"<font color=\" + c +\">\" + wp_name\n    \n    wp = plan.waypoints[wp_name]\n    desc = \"D:\"+wp.depth + \"m \"\n    if(wp.use_rpm) desc += wp.rpm+\"RPM\"\n    else desc += wp.speed+\" m/s\"\n    desc = \"<font color=\" + c +\">\" + desc\n    \n    list_item = {\n        title:title,\n        description:desc\n    }\n    list_items.push(list_item)\n}\n\nif(list_items.length > 0){\n    return {payload:list_items}    \n}else{\n    return {payload:[{title:\"--NO WPS--\"}]}\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 2640,
        "wires": [
            [
                "5e25569da4a16b0b"
            ]
        ]
    },
    {
        "id": "5e25569da4a16b0b",
        "type": "ui_list",
        "z": "65c60c3b274f73e3",
        "group": "a891e5f5f2effe35",
        "name": "wp list",
        "order": 11,
        "width": "6",
        "height": "3",
        "lineType": "two",
        "actionType": "click",
        "allowHTML": true,
        "outputs": 1,
        "topic": "",
        "x": 470,
        "y": 2640,
        "wires": [
            [
                "b35ff4ff8ec16352"
            ]
        ]
    },
    {
        "id": "e2f686ad8c4ade79",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_point",
        "mode": "link",
        "links": [
            "42cf4dd1c1379d75"
        ],
        "x": 435,
        "y": 180,
        "wires": []
    },
    {
        "id": "bcee15afbe079e57",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "point",
        "info": "",
        "x": 510,
        "y": 180,
        "wires": []
    },
    {
        "id": "42cf4dd1c1379d75",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_from_point",
        "links": [
            "e2f686ad8c4ade79"
        ],
        "x": 265,
        "y": 820,
        "wires": [
            [
                "c371b50c74bc5dee"
            ]
        ]
    },
    {
        "id": "70ee094504298935",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "point",
        "info": "",
        "x": 190,
        "y": 820,
        "wires": []
    },
    {
        "id": "4dd57f589bb24f4f",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "point can only happen if planning mode = true",
        "info": "",
        "x": 310,
        "y": 780,
        "wires": []
    },
    {
        "id": "c371b50c74bc5dee",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "add new wp to selected_plan",
        "func": "point = msg.payload\nif(!point.name || point.name===\"\") return\n\nplans = global.get(\"planning.plans\")\nif(!(plans)){\n    node.warn(\"Plans:\"+plans)\n    return\n}\n\nplan_name = global.get(\"gui.selected_plan_name\")\nplan = plans[plan_name]\n\n\nfunction new_wp(point){\n    return {\n        name:point.name,\n        lat:point.lat,\n        lon:point.lon,\n        depth:0,\n        rpm:0,\n        speed:0,\n        use_rpm:false\n    }\n}\n\nwp = new_wp(point)\nplan.waypoints[wp.name] = wp\nplan.waypoint_order.push(wp.name)\nplans[plan_name] = plan\nglobal.set(\"planning.plans\", plans)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 820,
        "wires": [
            [
                "ea992bd9a2452f80",
                "c6111a3afd78f6dd",
                "50598fa1155faa55",
                "69e69b055fdc6d3d"
            ]
        ]
    },
    {
        "id": "ea992bd9a2452f80",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "remove point from map, select wp",
        "func": "global.set(\"gui.selected_waypoint_name\", msg.payload.name)\n\nreturn {payload:{\n    \"action\":\"delete\",\n    \"name\":msg.payload.name,\n    \"deleted\":true\n}}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 820,
        "wires": [
            [
                "b185f6dbb37952e9"
            ]
        ]
    },
    {
        "id": "c60057a14b780187",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 730,
        "y": 860,
        "wires": []
    },
    {
        "id": "c1a9221f5cb68d31",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_update_listed_waypoints",
        "links": [
            "c6111a3afd78f6dd",
            "183bd5b7b2e98b79",
            "7e270ac4d823cbc0",
            "a89d30a55f0d8f15",
            "c4ac075074761e27",
            "2b59a55e85d5a494",
            "f9e34b689d61865f",
            "6ecdeb474d97bb05",
            "0db429c1a28c5125",
            "e892c74e5c27aee1",
            "2a1a62cfc5cae84d",
            "5c7f36f879d73a9b"
        ],
        "x": 215,
        "y": 2640,
        "wires": [
            [
                "f68e69985169cd78"
            ]
        ]
    },
    {
        "id": "c6111a3afd78f6dd",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 625,
        "y": 860,
        "wires": []
    },
    {
        "id": "183bd5b7b2e98b79",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 845,
        "y": 1660,
        "wires": []
    },
    {
        "id": "d68e96ba20db6bb1",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 960,
        "y": 1660,
        "wires": []
    },
    {
        "id": "1eaf2df713b5d698",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 100,
        "y": 2640,
        "wires": []
    },
    {
        "id": "f265c0e56f9d21af",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "just trigger",
        "func": "return {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 2680,
        "wires": [
            [
                "c15482e7569c2dda",
                "5fa6ab3ca15b659e",
                "5c7f36f879d73a9b",
                "3f285282ab31161f"
            ]
        ]
    },
    {
        "id": "c4ac075074761e27",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 525,
        "y": 1760,
        "wires": []
    },
    {
        "id": "131e486d1857bc3d",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 640,
        "y": 1760,
        "wires": []
    },
    {
        "id": "6b9216a6aec78960",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 255,
        "y": 1680,
        "wires": [
            [
                "0f340b20aa6be0bf"
            ]
        ]
    },
    {
        "id": "60e607fcad0d938d",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 160,
        "y": 1680,
        "wires": []
    },
    {
        "id": "34b418616dff4704",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 215,
        "y": 2600,
        "wires": [
            [
                "f68e69985169cd78"
            ]
        ]
    },
    {
        "id": "bb746a1ebd04cf1f",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 120,
        "y": 2600,
        "wires": []
    },
    {
        "id": "d847bf3e1bd6143b",
        "type": "config",
        "z": "65c60c3b274f73e3",
        "name": "gui",
        "properties": [
            {
                "p": "gui",
                "pt": "global",
                "to": "{\"selected_robot_name\":null,\"selected_waypoint_name\":null,\"selected_plan_name\":null,\"selected_track_name\":null,\"drawn_track_names\":null,\"draw_tracks\":false,\"follow_selected_vehicle\":false,\"bt_tip_log_len\":20,\"planning_mode\":false,\"drawn_on_map\":null}",
                "tot": "json"
            }
        ],
        "active": true,
        "x": 1290,
        "y": 140,
        "wires": []
    },
    {
        "id": "c64c7c9fbc69557c",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 305,
        "y": 640,
        "wires": [
            [
                "84dfa6ecdba12005"
            ]
        ]
    },
    {
        "id": "71bfde50ae8e91d3",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 220,
        "y": 640,
        "wires": []
    },
    {
        "id": "84dfa6ecdba12005",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 640,
        "wires": [
            [
                "87855a030ad4b56e"
            ]
        ]
    },
    {
        "id": "5096e7318cafb35a",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gui.planning_mode",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 680,
        "wires": [
            [
                "836e9b2d666ea992"
            ]
        ]
    },
    {
        "id": "df49c5e8f94952de",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "put selected wp handle on map",
        "func": "planning_mode = global.get(\"gui.planning_mode\")\nif(!planning_mode) {\n    //node.warn(\"Not in planning\")\n    return\n}\n\nswp_name = global.get(\"gui.selected_waypoint_name\")\nplan_name = global.get(\"gui.selected_plan_name\")\nplans = global.get(\"planning.plans\")\nplan = plans[plan_name]\nif(!(plan)){\n    //node.warn(\"No plan\")\n    return\n}\nswp = plan.waypoints[swp_name]\n\n\n\n\n\n// then put the select wp on the map\n// if there is a selected wp\n//node.warn(\"Marker for\"+swp.name)\nif(swp){\n    return {payload:\n        {\n            action:\"point\",\n            name:swp.name+\"_handle\",\n            label:null,\n            layer:\"planning\",\n            draggable:true,\n            lat:swp.lat,\n            lon:swp.lon,\n            ttl:0,\n            icon:\"circle\",\n            iconColor:\"orange\"\n        }}\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 1220,
        "wires": [
            [
                "c7d4d5de96d19781",
                "d443219a2ff95383"
            ]
        ]
    },
    {
        "id": "bb3002ce85983e34",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_update_markers_on_map",
        "links": [
            "836e9b2d666ea992",
            "c15482e7569c2dda",
            "503d00839a6bc893",
            "915f50a44adbc1b1",
            "a4c71623ce47e9e6",
            "50598fa1155faa55",
            "a7eba2ef10edab1f",
            "2a61996a1d3b6320",
            "86149028f57aa271",
            "5ad9f131ddd8bb21",
            "0e76935522f9aebc",
            "23c5e0d877fa805e",
            "a9b89912dfc6513c"
        ],
        "x": 205,
        "y": 1200,
        "wires": [
            [
                "8e14da82f369a630"
            ]
        ]
    },
    {
        "id": "52e8d0416334a3c6",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 190,
        "y": 1240,
        "wires": []
    },
    {
        "id": "b27a799d2b2389a3",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 1070,
        "y": 680,
        "wires": []
    },
    {
        "id": "836e9b2d666ea992",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 935,
        "y": 680,
        "wires": []
    },
    {
        "id": "95bf09d8a6505ee6",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 1110,
        "y": 2620,
        "wires": []
    },
    {
        "id": "c15482e7569c2dda",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 975,
        "y": 2620,
        "wires": []
    },
    {
        "id": "6ecdeb474d97bb05",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 1235,
        "y": 2520,
        "wires": []
    },
    {
        "id": "fc9dc6f796536d2c",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 1340,
        "y": 2520,
        "wires": []
    },
    {
        "id": "d2f284617e677636",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "clear planning layer",
        "func": "// get the list of stuff we drew before and delete them all\ndom = global.get(\"gui.drawn_on_map\") || new Set()\n\n\n// delete all the markers one by one because\n// for some reason the clear layer\n// thing doesnt delete them proper?\nfor(const item of dom){\n    p = {name:item, deleted:true, lat:0, lon:0}\n    node.send({payload:p})\n}\ndom = new Set()\n\n// clear the planning layer\n// and trigger some other stuff\nreturn [\n    {payload:{command:{clear:\"planning\"}}},\n    {}\n]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 1200,
        "wires": [
            [
                "c7d4d5de96d19781"
            ],
            [
                "df49c5e8f94952de",
                "86c0559201508b50",
                "087bc95837a9d012",
                "28047fbd71cfcbd5"
            ]
        ]
    },
    {
        "id": "86c0559201508b50",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "draw plans",
        "func": "selected_plan_name = global.get(\"gui.selected_plan_name\")\nplans = global.get(\"planning.plans\")\nselected_wp_name = global.get(\"gui.selected_waypoint_name\")\n\nfor(const plan_name in plans){\n    c = \"grey\"\n    line_width = 0.5\n    if(plan_name == selected_plan_name){\n        c = \"orange\"\n        line_width = 1.5\n    }\n    plan = plans[plan_name]\n    line = []\n    for(const wp_name of plan.waypoint_order){\n        wp = plan.waypoints[wp_name]\n        line.push([wp.lat, wp.lon])\n        \n        // also put a marker where the point is\n        // with the depth/rpm as label\n        // for the selected plan only\n        label = null\n        if(plan_name == selected_plan_name){\n            label = wp.name+\"(\"+wp.depth + \"m,\"\n            if(wp.use_rpm) label += wp.rpm+\"RPM)\"\n            else label += wp.speed+\" m/s)\"\n        }\n        \n        icon_color = \"grey\"\n        if(plan_name == selected_plan_name){\n            icon_color = \"#3f90bf\" //nice blue\n            if(wp_name == selected_wp_name) icon_color = \"orange\"\n        }\n        \n        \n        node.send({\n            payload:{\n                name: wp_name+\"_circle\",\n                radius: 3,\n                color: icon_color,\n                fillColor: icon_color,\n                lat: wp.lat,\n                lon: wp.lon,\n                label: label,\n                layer: \"planning\",\n                clickable: false\n            }\n        })\n    }\n    node.send(\n        {payload:{\n            name: plan_name+\"_plan_lines\",\n            line: line,\n            color: c,\n            layer: \"planning\",\n            width: line_width,\n        }})\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1260,
        "wires": [
            [
                "c7d4d5de96d19781",
                "d443219a2ff95383"
            ]
        ]
    },
    {
        "id": "7d660feb1bc9828d",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_move",
        "mode": "link",
        "links": [
            "098b89599a22a190"
        ],
        "x": 435,
        "y": 220,
        "wires": []
    },
    {
        "id": "9c91a7737e68d627",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "move",
        "info": "",
        "x": 510,
        "y": 220,
        "wires": []
    },
    {
        "id": "e52c7386b33fd223",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "update lat lon of wp",
        "func": "// {\"name\":\"t3\",\n// \"label\":\"t3\",\n// \"layer\":\"planning\",\n// \"draggable\":true,\n// \"lat\":58.251455,\n// \"lon\":11.456615,\n// \"hdg\":0,\n// \"ttl\":0,\n// \"icon\":\"circle\",\n// \"iconColor\":\"#910000\",\n// \"action\":\"move\",\n// \"from\":{\"lat\":58.251004,\"lon\":11.457687}}\n\nif(!global.get(\"gui.planning_mode\")) return {}\n\n// gotta assume a plan is selected\nselected_plan_name = global.get(\"gui.selected_plan_name\")\nplans = global.get(\"planning.plans\")\nplan = plans[selected_plan_name]\n\nwp = msg.payload\n// wp.name is sth like \"XXX_handle\"\nreal_wp_name = wp.name.split(\"_\")[0]\n\nif(!(real_wp_name in plan.waypoints)){\n    node.warn(real_wp_name+\" not in selected plan:\"+selected_plan_name)\n    return\n}\n\nplan.waypoints[real_wp_name].lat = wp.lat\nplan.waypoints[real_wp_name].lon = wp.lon\n\nglobal.set(\"planning.plans\", plans)\n\nreturn {payload:{}}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1020,
        "wires": [
            [
                "0db429c1a28c5125",
                "5a1eb09333cce11a",
                "915f50a44adbc1b1",
                "9e017fbc9b746fb9"
            ]
        ]
    },
    {
        "id": "098b89599a22a190",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "",
        "links": [
            "7d660feb1bc9828d"
        ],
        "x": 265,
        "y": 1020,
        "wires": [
            [
                "e52c7386b33fd223"
            ]
        ]
    },
    {
        "id": "8b199fc92fdeb6d7",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "move",
        "info": "",
        "x": 190,
        "y": 1020,
        "wires": []
    },
    {
        "id": "0db429c1a28c5125",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 535,
        "y": 980,
        "wires": []
    },
    {
        "id": "363c9e185561e5d1",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 660,
        "y": 980,
        "wires": []
    },
    {
        "id": "e25ea0dde8910944",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "selected wp properties",
        "func": "wp_name = global.get(\"gui.selected_waypoint_name\")\nplan_name = global.get(\"gui.selected_plan_name\")\nplans = global.get(\"planning.plans\")\nplan = plans[plan_name]\nswp = plan.waypoints[wp_name]\n\nlat = (swp.lat+\"\").substring(0,9)\nlon = (swp.lon+\"\").substring(0,9)\n\nreturn [\n    {payload: lat + \", \"+ lon},\n    {payload:swp.depth},\n    {payload:swp.rpm},\n    {payload:swp.speed},\n    {payload:swp.use_rpm}\n    ]",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 2520,
        "wires": [
            [
                "c36e098b35484df1"
            ],
            [
                "6596fde6e6662884"
            ],
            [
                "1ce3149408193422"
            ],
            [
                "b5d55ffd8630fd60"
            ],
            [
                "7d1b8d23041dbcc3",
                "f265c0e56f9d21af"
            ]
        ]
    },
    {
        "id": "a4bca789dbb9018b",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_update_selected_wp_properties",
        "links": [
            "5a1eb09333cce11a"
        ],
        "x": 315,
        "y": 2520,
        "wires": [
            [
                "e25ea0dde8910944"
            ]
        ]
    },
    {
        "id": "b2750038d28e1920",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update selected wp properties",
        "info": "",
        "x": 160,
        "y": 2520,
        "wires": []
    },
    {
        "id": "d0e17223e8d9baa8",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update selected wp properties",
        "info": "",
        "x": 700,
        "y": 1020,
        "wires": []
    },
    {
        "id": "5a1eb09333cce11a",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "a4bca789dbb9018b"
        ],
        "x": 535,
        "y": 1020,
        "wires": []
    },
    {
        "id": "51fb13b3a7c63078",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 690,
        "y": 1060,
        "wires": []
    },
    {
        "id": "915f50a44adbc1b1",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 535,
        "y": 1060,
        "wires": []
    },
    {
        "id": "d974149e3e68ba63",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "clear unknown layer",
        "func": "return {payload:{command:{clear:\"unknown\"}}}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 360,
        "wires": [
            [
                "3910098f87fb5eac"
            ]
        ]
    },
    {
        "id": "10e1cb2c6ad250d0",
        "type": "inject",
        "z": "65c60c3b274f73e3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 720,
        "y": 360,
        "wires": [
            [
                "d974149e3e68ba63"
            ]
        ]
    },
    {
        "id": "dd2579db1a75a915",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 760,
        "y": 900,
        "wires": []
    },
    {
        "id": "50598fa1155faa55",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 625,
        "y": 900,
        "wires": []
    },
    {
        "id": "07bfda0c88113da1",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 375,
        "y": 1160,
        "wires": [
            [
                "d2f284617e677636"
            ]
        ]
    },
    {
        "id": "a9fb56eca8203960",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 280,
        "y": 1160,
        "wires": []
    },
    {
        "id": "2990ad9cc099196a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 990,
        "y": 1620,
        "wires": []
    },
    {
        "id": "a7eba2ef10edab1f",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 845,
        "y": 1620,
        "wires": []
    },
    {
        "id": "a252ee0fd438b161",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_update_list_of_plans",
        "links": [
            "06b52e62f1cf32f9",
            "887a04d5bcde6631",
            "389bc260103b7207"
        ],
        "x": 255,
        "y": 1640,
        "wires": [
            [
                "0f340b20aa6be0bf",
                "ceae70c2ba4b7830",
                "a9e58882f4e7f8c8"
            ]
        ]
    },
    {
        "id": "50f814d2d1708729",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of plans",
        "info": "",
        "x": 130,
        "y": 1640,
        "wires": []
    },
    {
        "id": "06b52e62f1cf32f9",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "a252ee0fd438b161"
        ],
        "x": 1105,
        "y": 1800,
        "wires": []
    },
    {
        "id": "d5844b9c1f827b61",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of plans",
        "info": "",
        "x": 1230,
        "y": 1800,
        "wires": []
    },
    {
        "id": "85fcefa190bd58ec",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "rename plan",
        "group": "a891e5f5f2effe35",
        "order": 2,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Rename",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-pencil",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 390,
        "y": 1860,
        "wires": [
            [
                "e6ae60c52e377774"
            ]
        ]
    },
    {
        "id": "f5a86263da39c811",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "delete plan",
        "group": "a891e5f5f2effe35",
        "order": 3,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "Delete the selected plan",
        "color": "",
        "bgcolor": "Red",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 390,
        "y": 1900,
        "wires": [
            [
                "12de08ecd70dbfa4"
            ]
        ]
    },
    {
        "id": "200284fa17ca403a",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Rename",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "rename",
        "x": 720,
        "y": 1860,
        "wires": [
            [
                "0be06dba0165bcee"
            ]
        ]
    },
    {
        "id": "e6ae60c52e377774",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare rename",
        "func": "name = global.get(\"gui.selected_plan_name\")\nif(!name) return\nreturn {payload:\"Rename \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1860,
        "wires": [
            [
                "200284fa17ca403a"
            ]
        ]
    },
    {
        "id": "0be06dba0165bcee",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "rename selected plan",
        "func": "if(msg.payload == \"Cancel\") return\n\nnew_name = msg.payload\n\nplans = global.get(\"planning.plans\")\nif(new_name in Object.keys(plans)) return\n\nplan = plans[global.get(\"gui.selected_plan_name\")]\ndelete plans[plan.name]\n\nplan.name = new_name\nplans[new_name] = plan\nglobal.set(\"planning.plans\", plans)\nglobal.set(\"gui.selected_plan_name\", new_name)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 1860,
        "wires": [
            [
                "06b52e62f1cf32f9",
                "0f1be0abe9e97cb2"
            ]
        ]
    },
    {
        "id": "12de08ecd70dbfa4",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare delete",
        "func": "name = global.get(\"gui.selected_plan_name\")\nif(!name) return\nreturn {payload:\"Delete \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1900,
        "wires": [
            [
                "f21a5b2d8b3c6c96"
            ]
        ]
    },
    {
        "id": "f21a5b2d8b3c6c96",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "DELETE",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "delete",
        "x": 710,
        "y": 1900,
        "wires": [
            [
                "b0f090ceb3b734ad"
            ]
        ]
    },
    {
        "id": "b0f090ceb3b734ad",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "delete selected plan",
        "func": "if(msg.payload == \"Cancel\") return\n\nplans = global.get(\"planning.plans\")\nplan = plans[global.get(\"gui.selected_plan_name\")]\ndelete plans[plan.name]\n\nglobal.set(\"planning.plans\", plans)\nglobal.set(\"gui.selected_plan_name\", null)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 1900,
        "wires": [
            [
                "06b52e62f1cf32f9",
                "2a61996a1d3b6320",
                "e892c74e5c27aee1",
                "0f1be0abe9e97cb2"
            ]
        ]
    },
    {
        "id": "5089a1246d3fb479",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 1250,
        "y": 1900,
        "wires": []
    },
    {
        "id": "2a61996a1d3b6320",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 1105,
        "y": 1900,
        "wires": []
    },
    {
        "id": "e892c74e5c27aee1",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 1105,
        "y": 1940,
        "wires": []
    },
    {
        "id": "a185f27882a0d846",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 1220,
        "y": 1940,
        "wires": []
    },
    {
        "id": "3910098f87fb5eac",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_from_map_setup",
        "mode": "link",
        "links": [
            "1e0bd19ab17b797e"
        ],
        "x": 1115,
        "y": 300,
        "wires": []
    },
    {
        "id": "01d1b68c023ae715",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "map",
        "info": "",
        "x": 1200,
        "y": 300,
        "wires": []
    },
    {
        "id": "c7d4d5de96d19781",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_from_map_setup",
        "mode": "link",
        "links": [
            "1e0bd19ab17b797e"
        ],
        "x": 1145,
        "y": 1200,
        "wires": []
    },
    {
        "id": "9178d4c8aa1e20e1",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "map",
        "info": "",
        "x": 1220,
        "y": 1200,
        "wires": []
    },
    {
        "id": "b185f6dbb37952e9",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_from_map_setup",
        "mode": "link",
        "links": [
            "1e0bd19ab17b797e"
        ],
        "x": 935,
        "y": 820,
        "wires": []
    },
    {
        "id": "314311b14f8985f4",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "map",
        "info": "",
        "x": 1010,
        "y": 820,
        "wires": []
    },
    {
        "id": "d443219a2ff95383",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "accumulate drawn objects",
        "func": "dom = global.get(\"gui.drawn_on_map\")\nif(!dom){\n    dom = new Set()    \n} \ndom.add(msg.payload.name)\nglobal.set(\"gui.drawn_on_map\", dom)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "7e03fe39a9e4785c",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_from_map_setup",
        "mode": "link",
        "links": [
            "1e0bd19ab17b797e"
        ],
        "x": 935,
        "y": 640,
        "wires": []
    },
    {
        "id": "af6505f909c5191f",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "map",
        "info": "",
        "x": 1010,
        "y": 640,
        "wires": []
    },
    {
        "id": "5e5e0abaf6ad063c",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "rename wp",
        "group": "a891e5f5f2effe35",
        "order": 18,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Rename",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-pencil",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 2800,
        "wires": [
            [
                "fd9f37f1f59d843a"
            ]
        ]
    },
    {
        "id": "e994850c3d34e5c7",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Rename",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "rename",
        "x": 660,
        "y": 2800,
        "wires": [
            [
                "e9b740d9e80845c1"
            ]
        ]
    },
    {
        "id": "fd9f37f1f59d843a",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare rename",
        "func": "name = global.get(\"gui.selected_waypoint_name\")\nif(!name) return\nreturn {payload:\"Rename \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2800,
        "wires": [
            [
                "e994850c3d34e5c7"
            ]
        ]
    },
    {
        "id": "e9b740d9e80845c1",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "rename selected wp",
        "func": "if(msg.payload == \"Cancel\") return\n\nnew_name = msg.payload\n\nplans = global.get(\"planning.plans\")\nplan_name = global.get(\"gui.selected_plan_name\")\nplan = plans[plan_name]\nif(new_name in Object.keys(plan.waypoints)) return\n\nwp = plan.waypoints[global.get(\"gui.selected_waypoint_name\")]\ndelete plan.waypoints[wp.name]\n\nwp_i = plan.waypoint_order.indexOf(wp.name)\nwp.name = new_name\n\nplan.waypoints[new_name] = wp\nplan.waypoint_order[wp_i] = wp.name\n\n\nglobal.set(\"planning.plans\", plans)\nglobal.set(\"gui.selected_waypoint_name\", new_name)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 2800,
        "wires": [
            [
                "2a1a62cfc5cae84d",
                "86149028f57aa271",
                "e986e36477fb6a0d"
            ]
        ]
    },
    {
        "id": "4c0d1f4c2b893c06",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "delete wp",
        "group": "a891e5f5f2effe35",
        "order": 19,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "Delete the selected wp",
        "color": "",
        "bgcolor": "Red",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 320,
        "y": 2840,
        "wires": [
            [
                "6142dcb33f97df51"
            ]
        ]
    },
    {
        "id": "6142dcb33f97df51",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare delete",
        "func": "name = global.get(\"gui.selected_waypoint_name\")\nif(!name) return\nreturn {payload:\"Delete \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2840,
        "wires": [
            [
                "35e64f7efad6744b"
            ]
        ]
    },
    {
        "id": "35e64f7efad6744b",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "DELETE",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "delete",
        "x": 650,
        "y": 2840,
        "wires": [
            [
                "bc43cdcacce6b0b2"
            ]
        ]
    },
    {
        "id": "bc43cdcacce6b0b2",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "delete selected wp",
        "func": "if(msg.payload == \"Cancel\") return\n\nplans = global.get(\"planning.plans\")\nplan = plans[global.get(\"gui.selected_plan_name\")]\nwp = plan.waypoints[global.get(\"gui.selected_waypoint_name\")]\ndelete plan.waypoints[wp.name]\nwp_i = plan.waypoint_order.indexOf(wp.name)\nplan.waypoint_order.splice(wp_i, wp_i)\n\n\nglobal.set(\"planning.plans\", plans)\nglobal.set(\"gui.selected_waypoint_name\", null)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 2840,
        "wires": [
            [
                "2a1a62cfc5cae84d",
                "86149028f57aa271",
                "e986e36477fb6a0d"
            ]
        ]
    },
    {
        "id": "2cf5581bf4aff64e",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 1140,
        "y": 2800,
        "wires": []
    },
    {
        "id": "2a1a62cfc5cae84d",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 1025,
        "y": 2800,
        "wires": []
    },
    {
        "id": "fd895aa3247f4476",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 1170,
        "y": 2840,
        "wires": []
    },
    {
        "id": "86149028f57aa271",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 1025,
        "y": 2840,
        "wires": []
    },
    {
        "id": "17b5ae972bf306a0",
        "type": "ui_list",
        "z": "65c60c3b274f73e3",
        "group": "c68132315359e81c",
        "name": "track list",
        "order": 4,
        "width": 6,
        "height": 4,
        "lineType": "three",
        "actionType": "click",
        "allowHTML": true,
        "outputs": 1,
        "topic": "",
        "x": 460,
        "y": 3080,
        "wires": [
            [
                "1ecb86213b200219"
            ]
        ]
    },
    {
        "id": "18ebb3de66d804a6",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "list tracks",
        "func": "tracks = global.get(\"planning.tracks\") || {}\nglobal.set(\"planning.tracks\", tracks)\n\ndrawn_tracks = global.get(\"gui.drawn_track_names\") || new Set()\nglobal.set(\"gui.drawn_track_names\", drawn_tracks)\n\n\nif(!(tracks)){\n    return {payload:[{title:\"--NO TRACKS--\"}]}  \n} \nif(Object.keys(tracks).length < 1){\n    return {payload:[{title:\"--NO TRACKS--\"}]}     \n}\n\nlist_items = []\nfor(const track_name in tracks){\n    track = tracks[track_name]\n    c = \"black\"\n    if(track_name == global.get(\"gui.selected_track_name\")){\n        c = \"orange\"\n    }\n    \n    title = \"<font color=\" + c +\">\" + track.name\n    \n    if(track.recording){\n        duration_str = \"🔴 \" + parseInt((Date.now() - track.start)/1000) + \"s \"\n        title = duration_str + title\n    }\n    \n    if(drawn_tracks.has(track_name)){\n        title = \"🗺 ️\" + title\n    }\n    \n    desc = \"\"\n    if(track.robot_name) desc += \"🤖:\"+track.robot_name\n    if(track.start && track.end){\n        duration = parseInt((track.end - track.start)/1000)\n        if(duration > 120) duration_str = parseInt(duration/60) + \"m\" + duration%60+\"s\"\n        else duration_str = duration + \"s\"\n        desc += \" ⏲️:\" + duration_str\n    }\n    \n    if(track.start){\n        date = new Date(track.start).toDateString().slice(4)\n        desc += \" 📅:\" + date\n        \n        start_time = new Date(track.start).toTimeString().slice(0,8)\n        desc += \" ▶️:\" + start_time\n    }\n    \n    if(track.end){\n        end_time = new Date(track.end).toTimeString().slice(0,8)\n        desc += \" ⏹️:\" + end_time\n    }\n    \n    desc = \"<font color=\" + c +\">\" + desc\n    \n    list_item = {title:title, description:desc}\n    list_items.push(list_item)\n}\n\nreturn {payload:list_items}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 3080,
        "wires": [
            [
                "17b5ae972bf306a0"
            ]
        ]
    },
    {
        "id": "9e4dc1dfcbcf273a",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_update_track_list",
        "links": [
            "99a8b1e1f6f42347",
            "8a76125dbced6a15",
            "86c7eb05460bf065",
            "e8e6c12b50ea97fb",
            "0c34ba3ec1cfae86"
        ],
        "x": 205,
        "y": 3080,
        "wires": [
            [
                "18ebb3de66d804a6",
                "42294f1d6fd2420c"
            ]
        ]
    },
    {
        "id": "35d3cfdd994e02a9",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track list",
        "info": "",
        "x": 100,
        "y": 3080,
        "wires": []
    },
    {
        "id": "548c98181954e0bb",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "new track",
        "group": "c68132315359e81c",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "New Track",
        "tooltip": "Create a new track",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-map",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 320,
        "y": 3220,
        "wires": [
            [
                "deceb8a24bb64930"
            ]
        ]
    },
    {
        "id": "deceb8a24bb64930",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "new track",
        "func": "function new_track(){\n    now = Date.now()\n    t = new Date(now).toTimeString().slice(0,8)\n    return {\n        // name should be\n        // start time - robot_name - mission name\n        name:\"Track-\"+ t,\n        start: null,\n        end: null,\n        robot_name: null,\n        recording: false,\n        data: []\n    }\n}\n\ntrack = new_track()\ntracks = global.get(\"planning.tracks\")\ntracks[track.name] = track\nglobal.set(\"planning.tracks\", tracks)\nglobal.set(\"gui.selected_track_name\", track.name)\n\nreturn {payload:track, topic:\"new_track\"}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 3220,
        "wires": [
            [
                "99a8b1e1f6f42347"
            ]
        ]
    },
    {
        "id": "99a8b1e1f6f42347",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "9e4dc1dfcbcf273a",
            "a33b80c387b0a157"
        ],
        "x": 595,
        "y": 3220,
        "wires": []
    },
    {
        "id": "1ecb86213b200219",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "set selected track",
        "func": "title = msg.payload.title\nif(title == \"--NO TRACKS--\") return\ntrack_name = title.slice(title.indexOf(\">\")+1)\n\nglobal.set(\"gui.selected_track_name\", track_name)\n\nreturn {payload:track_name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 3080,
        "wires": [
            [
                "18ebb3de66d804a6",
                "0e76935522f9aebc",
                "74addf97d915bda4",
                "a03b339bae7b75a4"
            ]
        ]
    },
    {
        "id": "e33acbc846aa510f",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "delete track",
        "group": "c68132315359e81c",
        "order": 3,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "Delete the selected track",
        "color": "",
        "bgcolor": "Red",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3260,
        "wires": [
            [
                "449b196d04392d97"
            ]
        ]
    },
    {
        "id": "449b196d04392d97",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare delete",
        "func": "name = global.get(\"gui.selected_track_name\")\nif(!name) return\nreturn {payload:\"Delete \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3260,
        "wires": [
            [
                "e4c2a18511e58034"
            ]
        ]
    },
    {
        "id": "e4c2a18511e58034",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "DELETE",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "delete",
        "x": 670,
        "y": 3260,
        "wires": [
            [
                "0056037d4227ec33"
            ]
        ]
    },
    {
        "id": "0056037d4227ec33",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "delete selected track",
        "func": "if(msg.payload == \"Cancel\") return\n\ntracks = global.get(\"planning.tracks\")\ntrack = tracks[global.get(\"gui.selected_track_name\")]\ndelete tracks[track.name]\ndrawn_tracks = global.get(\"gui.drawn_track_names\")\ndrawn_tracks.delete(track.name)\n\nglobal.set(\"planning.tracks\", tracks)\nglobal.set(\"gui.selected_track_name\", null)\nglobal.set(\"gui.drawn_track_names\", drawn_tracks)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 3260,
        "wires": [
            [
                "8a76125dbced6a15",
                "23c5e0d877fa805e"
            ]
        ]
    },
    {
        "id": "8a76125dbced6a15",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "9e4dc1dfcbcf273a",
            "a33b80c387b0a157"
        ],
        "x": 1065,
        "y": 3300,
        "wires": []
    },
    {
        "id": "29f38a5e5f27cac5",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "rename track",
        "group": "c68132315359e81c",
        "order": 2,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Rename",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-pencil",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3300,
        "wires": [
            [
                "d4f20f6df999404f"
            ]
        ]
    },
    {
        "id": "6342038c5b344e48",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Rename",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "rename",
        "x": 680,
        "y": 3300,
        "wires": [
            [
                "cbb10f7262a76111"
            ]
        ]
    },
    {
        "id": "d4f20f6df999404f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "Prepare rename",
        "func": "name = global.get(\"gui.selected_track_name\")\nif(!name) return\nrtn = global.get(\"gui.recording_track_name\")\nif(name == rtn) return\nreturn {payload:\"Rename \"+ name}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3300,
        "wires": [
            [
                "6342038c5b344e48"
            ]
        ]
    },
    {
        "id": "cbb10f7262a76111",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "rename selected track",
        "func": "if(msg.payload == \"Cancel\") return\n\nnew_name = msg.payload\n\ntracks = global.get(\"planning.tracks\")\nif(new_name in Object.keys(tracks)) return\n\ntrack = tracks[global.get(\"gui.selected_track_name\")]\ndelete tracks[track.name]\ndrawn_tracks = global.get(\"gui.drawn_track_names\")\ndrawn_tracks.delete(track.name)\n\n\ntrack.name = new_name\ntracks[new_name] = track\ndrawn_tracks.add(new_name)\nglobal.set(\"planning.tracks\", tracks)\nglobal.set(\"gui.selected_track_name\", new_name)\nglobal.set(\"gui.drawn_track_names\", drawn_tracks)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 3300,
        "wires": [
            [
                "8a76125dbced6a15",
                "23c5e0d877fa805e"
            ]
        ]
    },
    {
        "id": "2ffb972b3b696e28",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track list",
        "info": "",
        "x": 1180,
        "y": 3300,
        "wires": []
    },
    {
        "id": "f55ec44e31806434",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "start record",
        "group": "c68132315359e81c",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Record",
        "tooltip": "Start recording tracks",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-play",
        "payload": "start",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3340,
        "wires": [
            [
                "3aa5d353667931cd"
            ]
        ]
    },
    {
        "id": "b1f0b0408e1bf101",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "stop record",
        "group": "c68132315359e81c",
        "order": 6,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Stop",
        "tooltip": "Stop recording into this track",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-stop",
        "payload": "stop",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3380,
        "wires": [
            [
                "3aa5d353667931cd"
            ]
        ]
    },
    {
        "id": "3aa5d353667931cd",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "setup recording",
        "func": "robot_name = global.get(\"gui.selected_robot_name\")\nif(!robot_name) return {}\n\ntracks = global.get(\"planning.tracks\")\nrecord = msg.payload == \"start\"\nstn = global.get(\"gui.selected_track_name\")\ntrack = tracks[stn]\n\nmessage = null\nif(record){\n    if(track.start == null) track.start = Date.now()\n    track.recording = true\n    track.robot_name = robot_name\n    message = \"recording_start\"\n}else{\n    if(track.recording) track.end = Date.now() \n    track.recording = false\n    track.data[track.data.length-1].annotation = \"recording_stop\"\n}\n        \n\nglobal.set(\"planning.tracks\", tracks)\n\nreturn {payload:message, topic:\"message\"}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3360,
        "wires": [
            [
                "e8e6c12b50ea97fb",
                "c10d70cecc53d8e9"
            ]
        ]
    },
    {
        "id": "e8e6c12b50ea97fb",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "9e4dc1dfcbcf273a",
            "a33b80c387b0a157"
        ],
        "x": 975,
        "y": 3360,
        "wires": []
    },
    {
        "id": "dc0dd819532c75cd",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track list",
        "info": "",
        "x": 1090,
        "y": 3360,
        "wires": []
    },
    {
        "id": "844b7bcc930e1da0",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 205,
        "y": 3040,
        "wires": [
            [
                "18ebb3de66d804a6"
            ]
        ]
    },
    {
        "id": "611f228d1236484a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 120,
        "y": 3040,
        "wires": []
    },
    {
        "id": "557d1122aa8559a7",
        "type": "inject",
        "z": "65c60c3b274f73e3",
        "name": "0.2s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "0.2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "timestamp",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 3400,
        "wires": [
            [
                "c10d70cecc53d8e9"
            ]
        ]
    },
    {
        "id": "c10d70cecc53d8e9",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "record",
        "func": "tracks = global.get(\"planning.tracks\")\nrobots = global.get(\"robot_states\")\n\nthere_is_recording = false\n\nfor(const track_name in tracks){\n    track = tracks[track_name]\n    if(track.recording){\n        robot = robots[track.robot_name]\n        // dont record if someone forgets to turn it off...\n        if(robot.gui.is_old){\n            track.recording = false\n            continue\n        }\n        // basically everything except the GUI stuff\n        r = {\n            last_update:robot.last_update,\n            base:JSON.parse(JSON.stringify(robot.base)),\n            bt:JSON.parse(JSON.stringify(robot.bt)),\n            annotation:null\n        }\n        if(msg.payload && msg.topic==\"message\"){\n            if(msg.payload != \"Cancel\") r.annotation = msg.payload\n        }\n        track.data.push(r)\n        there_is_recording = true\n    }\n}\n\n// only send a signal if there is a recording happening\nif(there_is_recording) return {}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 3400,
        "wires": [
            [
                "74752461385c4e8c"
            ]
        ]
    },
    {
        "id": "e2d73cfbd2e17b06",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "draw",
        "group": "c68132315359e81c",
        "order": 8,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Draw",
        "tooltip": "Draw the selected track on to the map",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-map-pin",
        "payload": "draw",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3480,
        "wires": [
            [
                "bbc37a4e7da34fee"
            ]
        ]
    },
    {
        "id": "9d1bfd91b12283b6",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "delete",
        "group": "c68132315359e81c",
        "order": 9,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Remove",
        "tooltip": "Remove the selected track from the map",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-eraser",
        "payload": "delete",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3520,
        "wires": [
            [
                "bbc37a4e7da34fee"
            ]
        ]
    },
    {
        "id": "bbc37a4e7da34fee",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "setup drawing",
        "func": "if(msg.payload == \"clear\"){\n    global.set(\"gui.drawn_track_names\", new Set())\n    return {}\n}\n\ntracks = global.get(\"planning.tracks\")\ndraw = msg.payload == \"draw\"\nstn = global.get(\"gui.selected_track_name\")\nif(!stn) return\n\ndrawn_track_names = global.get(\"gui.drawn_track_names\") || new Set()\n\nif(draw) drawn_track_names.add(stn)\nelse drawn_track_names.delete(stn)\n\nglobal.set(\"gui.drawn_track_names\", drawn_track_names)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 3520,
        "wires": [
            [
                "5ad9f131ddd8bb21",
                "0c34ba3ec1cfae86"
            ]
        ]
    },
    {
        "id": "32834dbd99db335a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 810,
        "y": 3540,
        "wires": []
    },
    {
        "id": "5ad9f131ddd8bb21",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 675,
        "y": 3540,
        "wires": []
    },
    {
        "id": "442ccceadb377078",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "take note",
        "group": "c68132315359e81c",
        "order": 7,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Take note",
        "tooltip": "",
        "color": "",
        "bgcolor": "Green",
        "className": "",
        "icon": "fa-indent",
        "payload": "Add text note to track",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 320,
        "y": 3420,
        "wires": [
            [
                "6609ceeeeb0325a4"
            ]
        ]
    },
    {
        "id": "6609ceeeeb0325a4",
        "type": "ui_toast",
        "z": "65c60c3b274f73e3",
        "position": "prompt",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "Save",
        "cancel": "Cancel",
        "raw": false,
        "className": "",
        "topic": "message",
        "name": "take note",
        "x": 540,
        "y": 3440,
        "wires": [
            [
                "c10d70cecc53d8e9"
            ]
        ]
    },
    {
        "id": "087bc95837a9d012",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "draw tracks",
        "func": "drawn_track_names = global.get(\"gui.drawn_track_names\")\nif(!drawn_track_names) return\ntracks = global.get(\"planning.tracks\")\nselected_track_name = global.get(\"gui.selected_track_name\")\n\nfor(const track_name of drawn_track_names){\n    track = tracks[track_name]\n    line = []\n    // if we encounter a string instead of a state,\n    // we want to attach that string to the next state point\n    // and show that on the map\n    // obviously back-to-back strings will over-write but meh\n    point_icons = []\n    for(const i in track.data){\n        point = track.data[i]\n        \n        if(point.annotation){\n            point_icon = {\n                    action: \"point\",\n                    layer: \"tracks\",\n                    label: point.annotation,\n                    lat: point.base.lat,\n                    lon: point.base.lon,\n                    name: track_name+\"_annotation_\"+i,\n                    icon: \"fa-xl fa-sticky-note-o\",\n                    iconColor: \"cyan\"\n                }\n            \n            if(point.annotation === \"recording_start\"){\n                point_icon.icon = \"fa-xl fa-play\"\n                point_icon.label = null\n            } \n            if(point.annotation === \"recording_stop\"){\n                point_icon.icon = \"fa-xl fa-pause\"\n                point_icon.label = null\n            } \n            if(parseInt(i)+1 >= track.data.length){\n                point_icon.icon = \"fa-xl fa-stop\"\n                point_icon.label = null\n            }\n            if(i==0) point_icon.label = track_name\n            if(track_name != selected_track_name) point_icon.label = null\n            \n            node.send({payload:point_icon})\n        }\n        \n        line.push([point.base.lat,point.base.lon])\n    }\n    \n    color = \"cyan\"\n    if(track_name == selected_track_name) color=\"orange\"\n    node.send(\n        {payload:{\n            name: track_name+\"_track_lines\",\n            line: line,\n            color: color,\n            layer: \"tracks\",\n            width: 0.5,\n        }})\n    \n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1300,
        "wires": [
            [
                "c7d4d5de96d19781",
                "d443219a2ff95383"
            ]
        ]
    },
    {
        "id": "74752461385c4e8c",
        "type": "delay",
        "z": "65c60c3b274f73e3",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 860,
        "y": 3380,
        "wires": [
            [
                "e8e6c12b50ea97fb"
            ]
        ]
    },
    {
        "id": "366ebfd517618e5f",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 910,
        "y": 3080,
        "wires": []
    },
    {
        "id": "0e76935522f9aebc",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 775,
        "y": 3080,
        "wires": []
    },
    {
        "id": "0c34ba3ec1cfae86",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "9e4dc1dfcbcf273a",
            "a33b80c387b0a157"
        ],
        "x": 675,
        "y": 3500,
        "wires": []
    },
    {
        "id": "7cead59b70db4f36",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track list",
        "info": "",
        "x": 780,
        "y": 3500,
        "wires": []
    },
    {
        "id": "0242a78a895ac92a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update_markers_on_map",
        "info": "",
        "x": 1210,
        "y": 3260,
        "wires": []
    },
    {
        "id": "23c5e0d877fa805e",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "bb3002ce85983e34"
        ],
        "x": 1065,
        "y": 3260,
        "wires": []
    },
    {
        "id": "6b87ac50d37a8ff4",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "clear",
        "group": "c68132315359e81c",
        "order": 10,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Clear",
        "tooltip": "Remove all tracks from the map",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "clear",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 3560,
        "wires": [
            [
                "bbc37a4e7da34fee"
            ]
        ]
    },
    {
        "id": "2645246b449b3b32",
        "type": "ui_text",
        "z": "65c60c3b274f73e3",
        "group": "a891e5f5f2effe35",
        "order": 10,
        "width": 6,
        "height": 1,
        "name": "wp title",
        "label": "WPs of",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 620,
        "y": 1540,
        "wires": []
    },
    {
        "id": "7f9a76f30e75a916",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "toggle",
        "func": "function r(del, rename, start,stop, note){\n    return [\n        {enabled:del},\n        {enabled:rename},\n        {enabled:start},\n        {enabled:stop},\n        {enabled:note}\n        ]\n}\n\ndel = false\nrename = false\nstart = false\nstop = false\nnote = false\n\n\nstn = global.get(\"gui.selected_track_name\")\n// no selected track, disable all buttons\nif(!stn){\n    return r(del, rename, start, stop, note)\n}\n\ntracks = global.get(\"planning.tracks\")\ntrack = tracks[stn]\n\ndel = true\nrename = true\nstart = true\n\nif(track.recording){\n    stop = true\n    start = false\n    note = true\n}\n\nreturn r(del, rename, start, stop, note)\n",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 3360,
        "wires": [
            [
                "e33acbc846aa510f"
            ],
            [
                "29f38a5e5f27cac5",
                "e2d73cfbd2e17b06",
                "9d1bfd91b12283b6"
            ],
            [
                "f55ec44e31806434"
            ],
            [
                "b1f0b0408e1bf101"
            ],
            [
                "442ccceadb377078"
            ]
        ]
    },
    {
        "id": "df793e20cb200651",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_toggle track buttons",
        "links": [
            "74addf97d915bda4",
            "42294f1d6fd2420c"
        ],
        "x": 85,
        "y": 3360,
        "wires": [
            [
                "7f9a76f30e75a916"
            ]
        ]
    },
    {
        "id": "74addf97d915bda4",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "df793e20cb200651"
        ],
        "x": 775,
        "y": 3120,
        "wires": []
    },
    {
        "id": "fe096776962448ef",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle track buttons",
        "info": "",
        "x": 110,
        "y": 3300,
        "wires": []
    },
    {
        "id": "07d50675dad6e412",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle track buttons",
        "info": "",
        "x": 890,
        "y": 3120,
        "wires": []
    },
    {
        "id": "42294f1d6fd2420c",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "df793e20cb200651"
        ],
        "x": 275,
        "y": 3140,
        "wires": []
    },
    {
        "id": "917ae3064fdd9c5c",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle track buttons",
        "info": "",
        "x": 390,
        "y": 3140,
        "wires": []
    },
    {
        "id": "73b7afa63e760dc5",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "toggle",
        "func": "function r(mod, control, start){\n    return [\n        {enabled:mod},\n        {enabled:control},\n        {enabled:start}\n        ]\n}\n\nmod = false\ncontrol = false\nstart = false\n\nspn = global.get(\"gui.selected_plan_name\")\n// no selected track, disable all buttons\nif(!spn){\n    return r(mod, control, start)\n}\n\nplans = global.get(\"planning.plans\")\nplan = plans[spn]\n\nmod = true\ncontrol = true\n\nif(plan.waypoint_order.length == 0) control = false\n\nsrn = global.get(\"gui.selected_robot_name\")\nrobots = global.get(\"robot_states\")\nrob = robots[srn]\n\nif(!rob) control = false\nif(rob.gui.is_old) control = false\nif(global.get(\"gui.plan_is_synched\")) start = true\nif(!control) start = false\n\nreturn r(mod, control, start)\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 1960,
        "wires": [
            [
                "85fcefa190bd58ec",
                "f5a86263da39c811",
                "7dd2fd0c91d149d6"
            ],
            [
                "dc136a38e8883e83",
                "1a59141260bce814",
                "9ec5bd30fbe9aa4b"
            ],
            [
                "302e64093f16fce0"
            ]
        ]
    },
    {
        "id": "2012902f23543fb8",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_toggle plan buttons",
        "links": [
            "ceae70c2ba4b7830",
            "66be8a1b9908737a",
            "7207113d4e01d2b1"
        ],
        "x": 95,
        "y": 1960,
        "wires": [
            [
                "73b7afa63e760dc5",
                "01868b25b2ab2ed7"
            ]
        ]
    },
    {
        "id": "03e2b806108ee187",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle plan buttons",
        "info": "",
        "x": 170,
        "y": 1920,
        "wires": []
    },
    {
        "id": "dc136a38e8883e83",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "send",
        "group": "a891e5f5f2effe35",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Send",
        "tooltip": "",
        "color": "",
        "bgcolor": "green",
        "className": "",
        "icon": "fa-send",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 1980,
        "wires": [
            [
                "07336c313cc6568e"
            ]
        ]
    },
    {
        "id": "98e4eb7e254e6efd",
        "type": "mqtt out",
        "z": "65c60c3b274f73e3",
        "name": "mission_control",
        "topic": "",
        "qos": "2",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1301e8ab7fdd3e72",
        "x": 780,
        "y": 2000,
        "wires": []
    },
    {
        "id": "07336c313cc6568e",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "make mission control",
        "func": "selected_plan_name = global.get(\"gui.selected_plan_name\")\nif(!selected_plan_name) return\n\nplans = global.get(\"planning.plans\")\nplan = plans[selected_plan_name]\n\nproper_wps = []\nfor(var i in plan.waypoint_order){\n    wp_name = plan.waypoint_order[i]\n    wp = plan.waypoints[wp_name]\n    if(wp){\n        speed_control_mode = 2 // m/s\n        if(wp.use_rpm) speed_control_mode = 1 //rpm\n        wp_msg = {\n          \"pose\": {\n            \"header\": {\n              \"seq\": 0,\n              \"stamp\": {\n                \"secs\": 0,\n                \"nsecs\": 0\n              },\n              \"frame_id\": \"latlon\"\n            },\n            \"pose\": {\n              \"position\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 0\n              },\n              \"orientation\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 0,\n                \"w\": 0\n              }\n            }\n          },\n          \"goal_tolerance\": 5,\n          \"z_control_mode\": 1, // depth\n          \"travel_altitude\": -1,\n          \"travel_depth\": wp.depth,\n          \"speed_control_mode\": speed_control_mode,\n          \"travel_rpm\": wp.rpm,\n          \"travel_speed\": wp.speed,\n          \"lat\": wp.lat,\n          \"lon\": wp.lon,\n          \"name\":wp.name\n        }\n        proper_wps.push(wp_msg)\n    }\n}\nmission_control = {\n    name: selected_plan_name,\n    command: 4, //set plan\n    waypoints: proper_wps\n}\n\nname = global.get(\"gui.selected_robot_name\")\nm = {\n    payload: mission_control,\n    topic: \"smarc/\"+name+\"/bt_cmd/mission_control\"\n}\nreturn m\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1980,
        "wires": [
            [
                "98e4eb7e254e6efd"
            ]
        ]
    },
    {
        "id": "302e64093f16fce0",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "Start",
        "group": "a891e5f5f2effe35",
        "order": 6,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Start",
        "tooltip": "Start the currently selected plan",
        "color": "",
        "bgcolor": "green",
        "className": "",
        "icon": "fa-play",
        "payload": "0",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 2020,
        "wires": [
            [
                "455a6ab8a54c744f"
            ]
        ]
    },
    {
        "id": "455a6ab8a54c744f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "make command",
        "func": "selected_plan_name = global.get(\"gui.selected_plan_name\")\nif(!selected_plan_name) return\n\nrobot_name = global.get(\"gui.selected_robot_name\")\n\nmission_control = {\n    name: selected_plan_name,\n    command: msg.payload\n}\n\nreturn {\n    payload: mission_control,\n    topic: \"smarc/\" + robot_name + \"/bt_cmd/mission_control\"\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 2020,
        "wires": [
            [
                "98e4eb7e254e6efd"
            ]
        ]
    },
    {
        "id": "9ec5bd30fbe9aa4b",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "Pause",
        "group": "a891e5f5f2effe35",
        "order": 7,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Pause",
        "tooltip": "Pause the currently selected plan",
        "color": "",
        "bgcolor": "blue",
        "className": "",
        "icon": "fa-pause",
        "payload": "2",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 2100,
        "wires": [
            [
                "455a6ab8a54c744f"
            ]
        ]
    },
    {
        "id": "1a59141260bce814",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "Stop",
        "group": "a891e5f5f2effe35",
        "order": 8,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Stop",
        "tooltip": "Stop the currently selected plan",
        "color": "",
        "bgcolor": "orange",
        "className": "",
        "icon": "fa-stop",
        "payload": "1",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 2060,
        "wires": [
            [
                "455a6ab8a54c744f"
            ]
        ]
    },
    {
        "id": "2f207331e5c78091",
        "type": "ui_button",
        "z": "65c60c3b274f73e3",
        "name": "Abort",
        "group": "a48b13904097fb6a",
        "order": 11,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "ABORT",
        "tooltip": "Emergency stop, one-way street",
        "color": "",
        "bgcolor": "red",
        "className": "",
        "icon": "fa-eject",
        "payload": "3",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 370,
        "y": 2140,
        "wires": [
            [
                "455a6ab8a54c744f"
            ]
        ]
    },
    {
        "id": "ceae70c2ba4b7830",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "2012902f23543fb8"
        ],
        "x": 335,
        "y": 1600,
        "wires": []
    },
    {
        "id": "63b2d28120775eb3",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle plan buttons",
        "info": "",
        "x": 450,
        "y": 1600,
        "wires": []
    },
    {
        "id": "66be8a1b9908737a",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "2012902f23543fb8"
        ],
        "x": 845,
        "y": 1580,
        "wires": []
    },
    {
        "id": "12a576379e429b98",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle plan buttons",
        "info": "",
        "x": 970,
        "y": 1580,
        "wires": []
    },
    {
        "id": "a9e58882f4e7f8c8",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "selected_plan_name",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gui.selected_plan_name",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 1560,
        "wires": [
            [
                "2645246b449b3b32"
            ]
        ]
    },
    {
        "id": "96bd5e1f1141c77f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "toggle",
        "func": "spn = global.get(\"gui.selected_plan_name\")\nif(!spn) return {enabled:false}\n\nplans = global.get(\"planning.plans\")\nplan = plans[spn]\n\nif(plan.waypoint_order.length == 0) return {enabled:false}\n\nswn = global.get(\"gui.selected_waypoint_name\")\nif(!swn) return {enabled:false}\n\nreturn {enabled:true}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 2420,
        "wires": [
            [
                "c36e098b35484df1",
                "6596fde6e6662884",
                "1ce3149408193422",
                "b5d55ffd8630fd60",
                "7d1b8d23041dbcc3",
                "0d2ac32c332f0416"
            ]
        ]
    },
    {
        "id": "b3ea1b7b39673b5c",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "toggle_wp_properties",
        "links": [
            "0be397d4764637a6",
            "f49c58686629d1ad",
            "4308dd074208279a",
            "5fa6ab3ca15b659e",
            "01868b25b2ab2ed7"
        ],
        "x": 585,
        "y": 2420,
        "wires": [
            [
                "96bd5e1f1141c77f"
            ]
        ]
    },
    {
        "id": "204c6d50c2d5f9ad",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle wp props",
        "info": "",
        "x": 480,
        "y": 2420,
        "wires": []
    },
    {
        "id": "5fa6ab3ca15b659e",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "b3ea1b7b39673b5c"
        ],
        "x": 975,
        "y": 2660,
        "wires": []
    },
    {
        "id": "c39b8bf425cf1ed5",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle wp props",
        "info": "",
        "x": 1080,
        "y": 2660,
        "wires": []
    },
    {
        "id": "01868b25b2ab2ed7",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "b3ea1b7b39673b5c"
        ],
        "x": 175,
        "y": 2000,
        "wires": []
    },
    {
        "id": "0c4a3040fc26bbeb",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle wp props",
        "info": "",
        "x": 180,
        "y": 2040,
        "wires": []
    },
    {
        "id": "9463c51f5d5790c3",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "wp buttons toggle",
        "links": [
            "0d2ac32c332f0416"
        ],
        "x": 205,
        "y": 2820,
        "wires": [
            [
                "5e5e0abaf6ad063c",
                "4c0d1f4c2b893c06"
            ]
        ]
    },
    {
        "id": "1beb1ce8fd854a54",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "wp button toggle",
        "info": "",
        "x": 100,
        "y": 2820,
        "wires": []
    },
    {
        "id": "0d2ac32c332f0416",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "9463c51f5d5790c3",
            "dc432fd8c414a1e9"
        ],
        "x": 795,
        "y": 2400,
        "wires": []
    },
    {
        "id": "735cb3f658efa37a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "wp button toggle",
        "info": "",
        "x": 900,
        "y": 2400,
        "wires": []
    },
    {
        "id": "85345819c7179b0b",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "wp button toggle",
        "info": "",
        "x": 1100,
        "y": 2460,
        "wires": []
    },
    {
        "id": "dc432fd8c414a1e9",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "wp buttons toggle",
        "links": [
            "0d2ac32c332f0416"
        ],
        "x": 1205,
        "y": 2460,
        "wires": [
            [
                "2a3c96232faf5eb1"
            ]
        ]
    },
    {
        "id": "404268e46f877811",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning_mode toggle",
        "links": [
            "7dd2fd0c91d149d6"
        ],
        "x": 425,
        "y": 600,
        "wires": [
            [
                "87855a030ad4b56e"
            ]
        ]
    },
    {
        "id": "41396310128c8091",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning mode toggle",
        "info": "",
        "x": 280,
        "y": 600,
        "wires": []
    },
    {
        "id": "7dd2fd0c91d149d6",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "404268e46f877811",
            "5a1ec79daf3b13c9",
            "0ec6c9c873d30dd2"
        ],
        "x": 335,
        "y": 1820,
        "wires": []
    },
    {
        "id": "34b015beb16d5216",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning mode toggle",
        "info": "",
        "x": 180,
        "y": 1820,
        "wires": []
    },
    {
        "id": "0415fe8d2492bfd5",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning mode toggle",
        "info": "",
        "x": 220,
        "y": 2700,
        "wires": []
    },
    {
        "id": "5a1ec79daf3b13c9",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning_mode toggle",
        "links": [
            "7dd2fd0c91d149d6"
        ],
        "x": 375,
        "y": 2700,
        "wires": [
            [
                "5e25569da4a16b0b"
            ]
        ]
    },
    {
        "id": "62b894f52a251e83",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning mode toggle",
        "info": "",
        "x": 360,
        "y": 1520,
        "wires": []
    },
    {
        "id": "0ec6c9c873d30dd2",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "toggle planning_mode toggle",
        "links": [
            "7dd2fd0c91d149d6"
        ],
        "x": 505,
        "y": 1520,
        "wires": [
            [
                "2645246b449b3b32"
            ]
        ]
    },
    {
        "id": "389bc260103b7207",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "a252ee0fd438b161"
        ],
        "x": 845,
        "y": 1700,
        "wires": []
    },
    {
        "id": "1aee60b690e0cd02",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of plans",
        "info": "",
        "x": 970,
        "y": 1700,
        "wires": []
    },
    {
        "id": "a2d92b46dda26406",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update list of wps",
        "info": "",
        "x": 1080,
        "y": 2700,
        "wires": []
    },
    {
        "id": "5c7f36f879d73a9b",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "c1a9221f5cb68d31",
            "4facb95ab46fd02a"
        ],
        "x": 975,
        "y": 2700,
        "wires": []
    },
    {
        "id": "6b234cf645da7fea",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "toggle readouts",
        "info": "",
        "x": 140,
        "y": 2140,
        "wires": []
    },
    {
        "id": "dee9d1fab2fcec69",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "toggle readouts",
        "links": [
            "cf8fbcc8cd92e83a"
        ],
        "x": 245,
        "y": 2140,
        "wires": [
            [
                "2f207331e5c78091"
            ]
        ]
    },
    {
        "id": "7731c057.0fb3f",
        "type": "chartjs-line",
        "z": "65c60c3b274f73e3",
        "name": "",
        "path": "linechart",
        "charttitle": "",
        "xaxis": "",
        "yaxis": "",
        "x": 610,
        "y": 4200,
        "wires": [
            []
        ]
    },
    {
        "id": "d10a669132c60ada",
        "type": "ui_iframe",
        "z": "65c60c3b274f73e3",
        "group": "f5cc24c294e35249",
        "name": "Linechart iframe",
        "order": 2,
        "width": 12,
        "height": 10,
        "url": "https://nodered.blue-robots.com/linechart",
        "origin": "*",
        "scale": "70",
        "x": 180,
        "y": 3840,
        "wires": [
            []
        ]
    },
    {
        "id": "a882f705d1edcf4e",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "List track properties",
        "func": "tracks = global.get(\"planning.tracks\")\nif(!tracks) return\n\nstn = global.get(\"gui.selected_track_name\")\nif(!stn) return\n\ntrack = tracks[stn]\n\nif(track.data.length < 1) return\n\nfirst = track.data[0]\nlast = track.data[track.data.length-1]\n\nt0 = parseInt(first.last_update/1000)\ntf = parseInt(last.last_update/1000)\n\n// title - title of the item,\n// description - description of the item. Optional if line type is Single-line or action type is menu,\n// menu - list of menu items (optional),\n// icon - URL of icon (optional),\n// icon_name - font icon name (optional).\n// icon_unicode - alternative to icon name - uses text characters (optional).\n// isChecked \n\ncharted_keys = global.get(\"gui.charted_keys\") || new Set()\nkeys = Object.keys(first.base)\nitems = []\nfor(const key of keys){\n    sample = first.base[key]\n    if (typeof sample === 'string' || sample instanceof String) continue\n    item = {\n        title:key,\n        isChecked: charted_keys.has(key)\n    }\n    items.push(item)\n}\n\n\nreturn [\n    {payload:items},\n    {ui_control:{max:tf-t0}}\n]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 4040,
        "wires": [
            [
                "3133589654d749f2"
            ],
            [
                "5d8a74769822794f",
                "4aee923d4f21ef0d"
            ]
        ]
    },
    {
        "id": "7a6888b95672e0f7",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "v2_map_to_map_setup",
        "links": [
            "ecb32f1e69ab1244"
        ],
        "x": 305,
        "y": 4020,
        "wires": [
            [
                "a882f705d1edcf4e",
                "eee48fffe688435d"
            ]
        ]
    },
    {
        "id": "236b94c7fd14ebfa",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "connected",
        "info": "",
        "x": 220,
        "y": 4020,
        "wires": []
    },
    {
        "id": "3133589654d749f2",
        "type": "ui_list",
        "z": "65c60c3b274f73e3",
        "group": "f5cc24c294e35249",
        "name": "Track props",
        "order": 1,
        "width": 6,
        "height": 8,
        "lineType": "one",
        "actionType": "check",
        "allowHTML": false,
        "outputs": 1,
        "topic": "",
        "x": 650,
        "y": 4000,
        "wires": [
            [
                "7f8f3bad61b15d6f"
            ]
        ]
    },
    {
        "id": "7f8f3bad61b15d6f",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "update chart keys",
        "func": "charted_keys = global.get(\"gui.charted_keys\") || new Set()\n\nif(msg.payload.isChecked){\n    charted_keys.add(msg.payload.title)\n}else{\n    charted_keys.delete(msg.payload.title)\n}\n\nglobal.set(\"gui.charted_keys\", charted_keys)\n\nreturn {}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 4000,
        "wires": [
            [
                "f758d7136cba8302"
            ]
        ]
    },
    {
        "id": "d657dc3704b36f50",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track props",
        "info": "",
        "x": 190,
        "y": 4060,
        "wires": []
    },
    {
        "id": "4f502f4b76819f09",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "update track props",
        "links": [
            "a03b339bae7b75a4"
        ],
        "x": 305,
        "y": 4060,
        "wires": [
            [
                "a882f705d1edcf4e",
                "eee48fffe688435d"
            ]
        ]
    },
    {
        "id": "a03b339bae7b75a4",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "4f502f4b76819f09",
            "3e398cf74e82408a"
        ],
        "x": 775,
        "y": 3040,
        "wires": []
    },
    {
        "id": "43536ab26742e5f2",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update track props",
        "info": "",
        "x": 890,
        "y": 3040,
        "wires": []
    },
    {
        "id": "5d8a74769822794f",
        "type": "ui_slider",
        "z": "65c60c3b274f73e3",
        "name": "",
        "label": "Time start",
        "tooltip": "",
        "group": "f5cc24c294e35249",
        "order": 5,
        "width": 12,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "start",
        "topicType": "str",
        "min": 0,
        "max": 10,
        "step": "1",
        "className": "",
        "x": 640,
        "y": 4040,
        "wires": [
            [
                "9b4736ce51b0892e"
            ]
        ]
    },
    {
        "id": "4aee923d4f21ef0d",
        "type": "ui_slider",
        "z": "65c60c3b274f73e3",
        "name": "",
        "label": "Duration",
        "tooltip": "",
        "group": "f5cc24c294e35249",
        "order": 7,
        "width": 12,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "duration",
        "topicType": "str",
        "min": "10",
        "max": "60",
        "step": "1",
        "className": "",
        "x": 640,
        "y": 4080,
        "wires": [
            [
                "a2f1d3b3c7a2b5b1"
            ]
        ]
    },
    {
        "id": "5bd4869c762f7e3e",
        "type": "ui_text",
        "z": "65c60c3b274f73e3",
        "group": "f5cc24c294e35249",
        "order": 3,
        "width": 6,
        "height": 2,
        "name": "new tab chart",
        "label": "",
        "format": "<a target=\"_blank\" href=\"https://nodered.blue-robots.com/linechart\">Chart in a new tab!</a> ",
        "layout": "col-center",
        "className": "",
        "x": 180,
        "y": 3800,
        "wires": []
    },
    {
        "id": "2eee1d2a8a2e7b36",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "draw current plan",
        "func": "robot = msg.payload\n\nwps = robot.bt.current_plan.waypoints\nif(!wps) return\n\npoints = []\nfor(var i in wps){\n        points.push([wps[i].lat, wps[i].lon])\n}\n\nswitch(robot.bt.current_plan.plan_state){\n    case 0: //running\n        c = \"orange\"\n        w = 2\n        break\n    case 1: // stopped\n        c = \"cyan\"\n        w = 1\n        break\n    case 2: // paused\n        c = \"yellow\"\n        w = 1\n        break\n    case 3: // emergency\n        c = \"red\"\n        w = 0.1\n        break\n    case 4: // received\n        c = \"yellow\"\n        w = 2\n        break\n}\n\nif(robot.gui.is_old) c = \"gray\"\n\nline = {name: robot.base.name+\"_vehicle_plan\",\n        layer: \"planning\",\n        line:points,\n        color:c,\n        weight:w,\n        editable:false,\n        clickable:false,\n        dashArray:\"1,8,5,8\"\n}\nreturn {payload:line}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1320,
        "wires": [
            [
                "c7d4d5de96d19781",
                "d443219a2ff95383"
            ]
        ]
    },
    {
        "id": "3df11c87b530efc4",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "marker on current wp",
        "func": "robot = msg.payload\n\nc = \"orange\"\nif(robot.gui.is_old) c = \"gray\"\n\nreturn {payload:\n        {\n            action:\"point\",\n            name: robot.base.name+\"_current_wp\",\n            label:null,\n            layer:\"planning\",\n            draggable:false,\n            lat:robot.bt.current_wp.lat,\n            lon:robot.bt.current_wp.lon,\n            ttl:0,\n            icon:\"locate\",\n            iconColor:c\n        }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 1360,
        "wires": [
            [
                "d443219a2ff95383",
                "c7d4d5de96d19781"
            ]
        ]
    },
    {
        "id": "28047fbd71cfcbd5",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "selected robot",
        "func": "srn = global.get(\"gui.selected_robot_name\")\nif(!srn) return\nrobots = global.get(\"robot_states\")\nrobot = robots[srn]\nif(!robot) return\n\nreturn {payload:robot}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 1340,
        "wires": [
            [
                "2eee1d2a8a2e7b36",
                "3df11c87b530efc4"
            ]
        ]
    },
    {
        "id": "eee48fffe688435d",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "update chart",
        "func": "// {\n//     \"channel\": \"TP01\",\n//     \"color\": \"Red\",\n//     \"dataset\": [\n//         {\n//             \"x\": \"01/02/2019 10:00\",\n//             \"y\": 10\n//         }\n//     ]\n// }\n\nfunction randomChoice(arr) {\n    return arr[Math.floor(arr.length * Math.random())];\n}\n\ncharted_keys = global.get(\"gui.charted_keys\") || new Set()\n\n\nif(charted_keys.size == 0){\n    return {payload:[{\n        channel:\"Select a property to chart!\",\n        color: \"\",\n        dataset:[]\n    }]}\n} \n\ntracks = global.get(\"planning.tracks\")\nstn = global.get(\"gui.selected_track_name\")\ntrack = tracks[stn]\n// wouldnt be here if the list wasnt prepped already\n\ngraphs = []\ncolors = [\"Red\", \"Blue\", \"Green\", \"Cyan\", \"Black\", \"Purple\"]\nvar i = 0\nfor(const key of charted_keys){\n    graph = {\n        channel: key,\n        color: colors[i],\n        dataset: []\n    }\n    i = (i+1)%colors.length\n    \n    t0 = null\n    for(const point of track.data){\n        t = point.last_update/1000\n        if(!t0) t0 = t\n        t -= t0\n        t = parseInt(t)\n        \n        start_t = global.get(\"gui.chart_start\") || 0\n        if(t < start_t) continue\n        \n        duration = global.get(\"gui.chart_duration\") || 10\n        if(t > start_t + duration) break\n        \n        v = point.base[key]\n        graph.dataset.push({x:t, y:v})\n    }\n    graphs.push(graph)\n}\nreturn {payload:graphs}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 4200,
        "wires": [
            [
                "7731c057.0fb3f"
            ]
        ]
    },
    {
        "id": "9b4736ce51b0892e",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "set chart start",
        "rules": [
            {
                "t": "set",
                "p": "gui.chart_start",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 4040,
        "wires": [
            [
                "f758d7136cba8302"
            ]
        ]
    },
    {
        "id": "a2f1d3b3c7a2b5b1",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "set chart duration",
        "rules": [
            {
                "t": "set",
                "p": "gui.chart_duration",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 4080,
        "wires": [
            [
                "f758d7136cba8302"
            ]
        ]
    },
    {
        "id": "b08025707fbc360d",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "update chart",
        "links": [
            "f758d7136cba8302",
            "adb7b6279e34b2a3"
        ],
        "x": 285,
        "y": 4200,
        "wires": [
            [
                "eee48fffe688435d"
            ]
        ]
    },
    {
        "id": "43e9c08e1bb0ba4d",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update chart",
        "info": "",
        "x": 190,
        "y": 4200,
        "wires": []
    },
    {
        "id": "d133be335a141839",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update chart",
        "info": "",
        "x": 1070,
        "y": 4040,
        "wires": []
    },
    {
        "id": "f758d7136cba8302",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "b08025707fbc360d",
            "e7ddbfbe591019ba"
        ],
        "x": 975,
        "y": 4040,
        "wires": []
    },
    {
        "id": "1b5cc6cb3a03dbd9",
        "type": "ui_switch",
        "z": "65c60c3b274f73e3",
        "name": "auto update",
        "label": "Auto-refresh",
        "tooltip": "Update the chart every 5 seconds",
        "group": "f5cc24c294e35249",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 170,
        "y": 3880,
        "wires": [
            [
                "9e0a3e3665047939"
            ]
        ]
    },
    {
        "id": "4395efd9a77aeb7a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update chart",
        "info": "",
        "x": 870,
        "y": 3880,
        "wires": []
    },
    {
        "id": "adb7b6279e34b2a3",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "b08025707fbc360d",
            "e7ddbfbe591019ba"
        ],
        "x": 775,
        "y": 3880,
        "wires": []
    },
    {
        "id": "e4f9a6bc89eb2e49",
        "type": "delay",
        "z": "65c60c3b274f73e3",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 600,
        "y": 3840,
        "wires": [
            [
                "b7b4a7a97984db89"
            ]
        ]
    },
    {
        "id": "1b52051d14f947f4",
        "type": "link in",
        "z": "65c60c3b274f73e3",
        "name": "update chart props",
        "links": [
            "e382855cb1c7136c"
        ],
        "x": 305,
        "y": 3980,
        "wires": [
            [
                "a882f705d1edcf4e"
            ]
        ]
    },
    {
        "id": "2f26c38c7217f709",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update chart props",
        "info": "",
        "x": 190,
        "y": 3980,
        "wires": []
    },
    {
        "id": "e382855cb1c7136c",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "1b52051d14f947f4"
        ],
        "x": 775,
        "y": 3840,
        "wires": []
    },
    {
        "id": "23cb765a962738a8",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "update chart props",
        "info": "",
        "x": 890,
        "y": 3840,
        "wires": []
    },
    {
        "id": "f12f41d73aa8bdfc",
        "type": "function",
        "z": "65c60c3b274f73e3",
        "name": "set start to last",
        "func": "tracks = global.get(\"planning.tracks\")\nif(!tracks) return\nstn = global.get(\"gui.selected_track_name\")\nif(!stn) return\ntrack = tracks[stn]\nif(track.data.length < 1) return\n\nfirst = track.data[0]\nlast = track.data[track.data.length-1]\n\nt0 = parseInt(first.last_update/1000)\ntf = parseInt(last.last_update/1000)\n\n\nduration = global.get(\"gui.chart_duration\") || 10\n\nreturn {payload: tf-t0 - duration}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 3940,
        "wires": [
            [
                "5d8a74769822794f"
            ]
        ]
    },
    {
        "id": "9e0a3e3665047939",
        "type": "change",
        "z": "65c60c3b274f73e3",
        "name": "set gui chart_auto_update",
        "rules": [
            {
                "t": "set",
                "p": "gui.chart_auto_update",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 3880,
        "wires": [
            [
                "b7b4a7a97984db89"
            ]
        ]
    },
    {
        "id": "b7b4a7a97984db89",
        "type": "switch",
        "z": "65c60c3b274f73e3",
        "name": "if auto update",
        "property": "gui.chart_auto_update",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 600,
        "y": 3880,
        "wires": [
            [
                "e382855cb1c7136c",
                "adb7b6279e34b2a3",
                "f12f41d73aa8bdfc",
                "e4f9a6bc89eb2e49"
            ],
            []
        ]
    },
    {
        "id": "0f1be0abe9e97cb2",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 1105,
        "y": 1840,
        "wires": []
    },
    {
        "id": "161a51af856b129a",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 1260,
        "y": 1840,
        "wires": []
    },
    {
        "id": "3f285282ab31161f",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 975,
        "y": 2740,
        "wires": []
    },
    {
        "id": "235e007ba94daedb",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 1130,
        "y": 2740,
        "wires": []
    },
    {
        "id": "e986e36477fb6a0d",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 1025,
        "y": 2880,
        "wires": []
    },
    {
        "id": "15845c15992a95db",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 1180,
        "y": 2880,
        "wires": []
    },
    {
        "id": "9e017fbc9b746fb9",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 535,
        "y": 1100,
        "wires": []
    },
    {
        "id": "e25678d5afc89216",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 700,
        "y": 1100,
        "wires": []
    },
    {
        "id": "69e69b055fdc6d3d",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 625,
        "y": 780,
        "wires": []
    },
    {
        "id": "0dc598b9420e8932",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 780,
        "y": 780,
        "wires": []
    },
    {
        "id": "af81f151aebb2dcc",
        "type": "link out",
        "z": "65c60c3b274f73e3",
        "name": "",
        "mode": "link",
        "links": [
            "f73376f194b1fc1a"
        ],
        "x": 675,
        "y": 600,
        "wires": []
    },
    {
        "id": "5b1ae6d42b5c714c",
        "type": "comment",
        "z": "65c60c3b274f73e3",
        "name": "compare gui and robot plans",
        "info": "",
        "x": 830,
        "y": 600,
        "wires": []
    },
    {
        "id": "8e14da82f369a630",
        "type": "delay",
        "z": "65c60c3b274f73e3",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 1,
        "x": 320,
        "y": 1200,
        "wires": [
            [
                "d2f284617e677636"
            ]
        ]
    }
]